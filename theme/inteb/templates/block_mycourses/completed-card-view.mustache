{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

    @template block_mycourses/completed-card-view

    This template renders the completed courses view for the mycourses block.
    Redesigned for theme_inteb with modern card layout.

    Context variables required for this template:
    * completedview - Object containing courses array
    * nocourses - URL for empty state image

    Example context (json):
    {
        "completedview": {
            "courses": [
                {
                    "id": 1,
                    "fullname": "Course Name",
                    "shortname": "CN",
                    "courseimage": "url",
                    "viewurl": "url",
                    "coursecategory": "Category",
                    "timecompleted": "01/01/2024",
                    "timeexpires": "01/01/2025",
                    "finalscore": 85,
                    "hasgrade": true,
                    "certificates": []
                }
            ]
        }
    }
}}
<div id="completed-view-{{uniqid}}" data-region="completed-view" class="inteb-mycourses-view">
    <div class="tab-content">
        <div class="tab-pane active" id="mycourses_completed_view">
            <div id="paged-content-container-{{uniqid}}" data-region="paged-content-container">
                <div id="paged-content-page" data-page="1">
                    {{#completedview.courses}}
                    {{#completedview.courses.0}}
                    <div class="inteb-course-grid row" data-region="card-deck" role="list">
                    {{/completedview.courses.0}}
                        {{#completedview.courses}}
                        <div class="col-12 col-sm-6 col-lg-4 col-xl-3 mb-4" role="listitem">
                            <div class="inteb-course-card inteb-completed-card card h-100 shadow-sm" data-region="course-content" data-course-id="{{{id}}}">
                                {{! Course Image }}
                                <div class="inteb-card-img-wrapper position-relative">
                                    <a href="{{viewurl}}" class="d-block" tabindex="-1">
                                        <div class="inteb-card-img" style="background-image: url('{{{courseimage}}}');">
                                            <div class="inteb-card-overlay inteb-completed-overlay"></div>
                                        </div>
                                    </a>
                                    {{! Completed Badge }}
                                    <div class="inteb-completed-badge position-absolute">
                                        <span class="badge badge-success">
                                            <i class="fa fa-check-circle mr-1" aria-hidden="true"></i>
                                            {{#str}}completed, block_mycourses{{/str}}
                                        </span>
                                    </div>
                                    {{! Visibility and Favorite Icons }}
                                    <div class="inteb-card-badges position-absolute">
                                        {{> core_course/favouriteicon }}
                                        {{^visible}}
                                        <span class="badge badge-warning" title="{{#str}}hiddenfromstudents{{/str}}">
                                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                                        </span>
                                        {{/visible}}
                                    </div>
                                    {{! Category Badge }}
                                    {{#coursecategory}}
                                    <div class="inteb-category-badge position-absolute">
                                        <span class="badge badge-primary text-truncate" title="{{{coursecategory}}}">
                                            {{{coursecategory}}}
                                        </span>
                                    </div>
                                    {{/coursecategory}}
                                </div>

                                {{! Card Body }}
                                <div class="card-body d-flex flex-column">
                                    {{! Course Title }}
                                    <h5 class="inteb-course-title mb-2">
                                        <a href="{{viewurl}}" class="text-dark stretched-link" title="{{{fullname}}}">
                                            {{{fullname}}}
                                        </a>
                                    </h5>

                                    {{! Short name if enabled }}
                                    {{#showshortname}}
                                    <p class="text-muted small mb-2">{{{shortname}}}</p>
                                    {{/showshortname}}

                                    {{! Completion Info }}
                                    <div class="inteb-completion-info mt-auto">
                                        {{! Progress Bar (100%) }}
                                        <div class="inteb-progress-wrapper mb-2">
                                            <div class="progress inteb-progress inteb-progress-completed">
                                                <div class="progress-bar bg-success"
                                                     role="progressbar"
                                                     style="width: 100%;"
                                                     aria-valuenow="100"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100">
                                                </div>
                                            </div>
                                        </div>

                                        {{! Completion Date }}
                                        {{#timecompleted}}
                                        <div class="inteb-info-row small mb-1">
                                            <i class="fa fa-calendar-check-o text-success mr-1" aria-hidden="true"></i>
                                            <span class="text-muted">{{#str}}timecompleted, local_report_completion{{/str}}:</span>
                                            <strong class="ml-1">{{timecompleted}}</strong>
                                        </div>
                                        {{/timecompleted}}

                                        {{! Expiry Date }}
                                        {{#timeexpires}}
                                        <div class="inteb-info-row small mb-1">
                                            <i class="fa fa-clock-o text-warning mr-1" aria-hidden="true"></i>
                                            <span class="text-muted">{{#str}}timeexpires, local_report_completion{{/str}}:</span>
                                            <strong class="ml-1">{{timeexpires}}</strong>
                                        </div>
                                        {{/timeexpires}}

                                        {{! Final Score }}
                                        {{#hasgrade}}
                                        <div class="inteb-info-row small mb-1">
                                            <i class="fa fa-star text-primary mr-1" aria-hidden="true"></i>
                                            <span class="text-muted">{{#str}}finalscore, block_mycourses{{/str}}:</span>
                                            <strong class="ml-1 text-primary">{{finalscore}}%</strong>
                                        </div>
                                        {{/hasgrade}}
                                        {{^hasgrade}}
                                        <div class="inteb-info-row small mb-1">
                                            <i class="fa fa-check text-success mr-1" aria-hidden="true"></i>
                                            <span class="text-muted">{{#str}}result, block_mycourses{{/str}}:</span>
                                            <strong class="ml-1 text-success">{{finalscore}}</strong>
                                        </div>
                                        {{/hasgrade}}

                                        {{! Certificates }}
                                        {{#certificates}}
                                        {{#certificates.0}}
                                        <div class="inteb-certificates mt-2 pt-2 border-top">
                                            <div class="small text-muted mb-1">
                                                <i class="fa fa-certificate mr-1" aria-hidden="true"></i>
                                                {{#str}}downloadcert, block_mycourses{{/str}}:
                                            </div>
                                            <div class="d-flex flex-wrap">
                                        {{/certificates.0}}
                                                {{#certificates}}
                                                <a href="{{certificateurl}}" class="inteb-cert-link mr-2 mb-1" title="{{certificatename}}" target="_blank">
                                                    <img src="{{certificateimage}}" alt="{{certificatename}}" class="inteb-cert-icon">
                                                </a>
                                                {{/certificates}}
                                        {{#certificates.0}}
                                            </div>
                                        </div>
                                        {{/certificates.0}}
                                        {{/certificates}}
                                    </div>
                                </div>

                                {{! Card Footer }}
                                <div class="card-footer bg-transparent border-0 pt-0">
                                    <a href="{{viewurl}}" class="btn btn-outline-secondary btn-sm btn-block inteb-review-btn">
                                        <i class="fa fa-eye mr-1" aria-hidden="true"></i>
                                        {{#str}}viewcourse, block_mycourses{{/str}}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {{/completedview.courses}}
                    {{#completedview.courses.0}}
                    </div>
                    {{/completedview.courses.0}}
                    {{/completedview.courses}}

                    {{! Empty State }}
                    {{^completedview.courses}}
                    <div class="inteb-empty-state text-center py-5">
                        <div class="inteb-empty-icon mb-3">
                            <i class="fa fa-trophy fa-4x text-muted"></i>
                        </div>
                        <h5 class="text-muted mb-2">{{#str}}nocompleted, block_mycourses{{/str}}</h5>
                        <p class="text-muted small">{{#str}}nocompleted, block_mycourses{{/str}}</p>
                    </div>
                    {{/completedview.courses}}
                </div>
            </div>
        </div>
    </div>
</div>

{{#js}}
require(['jquery', 'core/custom_interaction_events'], function($, customEvents) {
    var root = $('#completed-view-{{uniqid}}');
    customEvents.define(root, [customEvents.events.activate]);
    root.on(customEvents.events.activate, '[data-toggle="btns"] > .btn', function() {
        root.find('.btn.active').removeClass('active');
    });
});
{{/js}}
