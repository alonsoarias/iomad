{"version":3,"sources":["../src/courseindex_progress.js"],"names":["define","$","Ajax","Notification","init","courseId","checkInterval","setInterval","sections","length","clearInterval","loadAllSectionsProgress","document","on","each","$progressContainer","this","sectionId","data","loadSectionProgress","promises","call","methodname","args","courseid","then","response","hasprogress","updateProgressDisplay","catch","error","errorcode","window","console","log","$container","percentage","complete","total","$progressBar","find","css","attr","removeClass","addClass","text","slideDown"],"mappings":"AAyBAA,OAAO,CAAC,SAAU,YAAa,qBAAsB,SAASC,EAAGC,EAAMC,GAKnE,IAAIC,EAAO,SAASC,GAGhB,IAAIC,EAAgBC,YAAY,WAC5B,IAAIC,EAAWP,EAAE,yBACbO,EAASC,OAAS,IAClBC,cAAcJ,GACdK,EAAwBN,IAE7B,KAGHO,EAASC,GAAG,iBAAkB,WACpBF,EAAwBN,MAI3CM,EAA0B,SAASN,GAC/BJ,EAAE,iCAAiCa,KAAK,WACpC,IAAIC,EAAqBd,EAAEe,MACvBC,EAAYF,EAAmBG,KAAK,cAEpCD,IAAYD,EAAmBE,KAAK,WACpCC,EAAoBd,EAAUU,EAAWD,OAMrDK,EAAsB,SAASd,EAAUU,EAAWH,GAGhD,IAAIQ,EAAWlB,EAAKmB,KAAK,CAAC,CACfC,WAAY,uCACZC,KAAM,CACFC,QAAST,EACTV,SAAUA,OAM5Be,EAAS,GACLK,KAAK,SAASC,GAIV,OAHAZ,EAAmBG,KAAK,UAAU,GAE9BS,GAAcA,EAASC,aACvBC,EAAsBf,EAAoBa,IAExC,KACR,SACDG,MAAM,SAASC,GAEZhB,EAAmBG,KAAK,UAAU,GAG9Ba,GAAoB,iBAARA,EAAMC,WAClBC,OAAOC,SAAWD,OAAOC,QAAQC,IAAI,mCAAoCJ,OAKzFD,EAAwB,SAASf,EAAYa,GAE7C,GAAKb,GAAUA,EAAWb,QAAU,EAApC,CAEA,IAAIkC,EAAaT,EAASS,YAAc,EACpCC,EAAWV,EAASU,UAAY,EAChCC,EAAQX,EAASW,OAAS,EAG1BC,EAAexB,EAAWyB,KAAK,gBAC/BD,EAAahC,OAAS,IACtBgC,EACCE,IAAI,QAAUL,EAAa,MAC3BM,KAAK,gBAAiBN,GAG3BG,EAAaI,YAAY,wDAEnBP,IAAe,IAChBG,EAAaK,SAAS,cAEfR,GAAc,GAErBG,EAAaK,SAAS,WAEfR,GAAc,GAErBG,EAAaK,SAAS,cAEfR,EAAa,GAEpBG,EAAaK,SAAS,cAK1B5B,EAAWyB,KAAK,mBAAmBlC,OAAS,GAC5CS,EAAWyB,KAAK,mBAAmBI,KAAKP,EAAW,MAAQC,GAG3DvB,EAAWyB,KAAK,uBAAuBlC,OAAS,GAChDS,EAAWyB,KAAK,uBAAuBI,KAAKT,EAAa,KAI7DrB,EAAW+B,UAAU,GAH1B,IAAIpD,GAQH,MAAO,CACHG,KAAMA","file":"courseindex_progress.min.js","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course index progress loader\n *\n * @module     theme_compecer/courseindex_progress\n * @copyright  2024 IngeWeb https://www.ingeweb.co\n * @author     Alonso Arias <soporte@ingeweb.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    /**\n     * Initialize the course index progress\n     *\n     * @param {Number} courseId The course ID\n     */\n    var init = function(courseId) {\n\n        // Wait for the courseindex to be fully loaded\n        var checkInterval = setInterval(function() {\n            var sections = $('.course-index-section');\n            if (sections.length > 0) {\n                clearInterval(checkInterval);\n                loadAllSectionsProgress(courseId);\n            }\n        }, 500);\n\n        // Also listen for courseindex updates\n        $(document).on('state-changed', function() {\n            loadAllSectionsProgress(courseId);\n        });\n    };\n\n    /**\n     * Load progress for all sections\n     *\n     * @param {Number} courseId The course ID\n     */\n    var loadAllSectionsProgress = function(courseId) {\n        $('.course-index-section-progress').each(function() {\n            var $progressContainer = $(this);\n            var sectionId = $progressContainer.data('section-id');\n\n            if (sectionId && !$progressContainer.data('loaded')) {\n                loadSectionProgress(courseId, sectionId, $progressContainer);\n            }\n        });\n    };\n\n    /**\n     * Load progress for a specific section\n     *\n     * @param {Number} courseId The course ID\n     * @param {Number} sectionId The section ID\n     * @param {jQuery} $container The progress container element\n     */\n    var loadSectionProgress = function(courseId, sectionId, $container) {\n\n        // Call the web service\n        var promises = Ajax.call([{\n            methodname: 'theme_compecer_get_section_progress',\n            args: {\n                sectionid: sectionId,\n                courseid: courseId\n            }\n        }]);\n\n        promises[0]\n            .then(function(response) {\n                // Mark as loaded to prevent repeated attempts\n                $container.data('loaded', true);\n\n                if (response && response.hasprogress) {\n                    updateProgressDisplay($container, response);\n                }\n                return;\n            })\n            .catch(function(error) {\n                // Mark as loaded even on error to prevent repeated attempts\n                $container.data('loaded', true);\n\n                // Only log errors that are not permission-related\n                if (error && error.errorcode !== 'nopermissions') {\n                    window.console && console.log('Error loading section progress:', error);\n                }\n            });\n    };\n\n    /**\n     * Update the progress display\n     *\n     * @param {jQuery} $container The progress container element\n     * @param {Object} data Progress data\n     */\n    var updateProgressDisplay = function($container, data) {\n        // Verify container still exists in DOM\n        if (!$container || $container.length === 0) {\n            return;\n        }\n\n        var percentage = data.percentage || 0;\n        var complete = data.complete || 0;\n        var total = data.total || 0;\n\n        // Update progress bar\n        var $progressBar = $container.find('.progress-bar');\n        if ($progressBar.length > 0) {\n            $progressBar\n                .css('width', percentage + '%')\n                .attr('aria-valuenow', percentage);\n\n            // Color code based on progress\n            $progressBar.removeClass('bg-success bg-info bg-warning bg-danger');\n\n            if (percentage === 100) {\n                $progressBar.addClass('bg-success');\n            } else if (percentage >= 70) {\n                $progressBar.addClass('bg-info');\n            } else if (percentage >= 40) {\n                $progressBar.addClass('bg-warning');\n            } else if (percentage > 0) {\ $progressBar.addClass('bg-danger');\n            }\n        }\n\n        // Update progress text\n        var $progressCount = $container.find('.progress-count');\n        if ($progressCount.length > 0) {\n            $progressCount.text(complete + ' / ' + total);\n        }\n\n        var $progressPercentage = $container.find('.progress-percentage');\n        if ($progressPercentage.length > 0) {\n            $progressPercentage.text(percentage + '%');\n        }\n\n        // Show the progress container with animation\n        $container.slideDown(300);\n    };\n\n    return {\n        init: init\n    };\n});\n"]}
