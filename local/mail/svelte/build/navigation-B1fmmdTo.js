import{S as T,b as B,e as j,n as v,f as k,g as y,h as H,I as R,J as F,U as I,o as M,W as J,X as O,p as g,j as w,H as S,t as U,k as m,at as C,D as W,a6 as q,as as X,a3 as z}from"./global-CUTJa-Jf.js";function E(s,t,e){const n=s.slice();return n[10]=t[e],n}function L(s){let t,e,n,i,d=s[0].sendmail+"",u,l,f,o,b=[],_=new Map,p=I(["to","cc","bcc"]);const c=r=>r[10];for(let r=0;r<3;r+=1){let a=E(s,p,r),h=c(a);_.set(h,b[r]=D(h,a))}return{c(){t=w("div"),e=w("button"),n=w("i"),i=S(),u=U(d),f=S(),o=w("div");for(let r=0;r<3;r+=1)b[r].c();m(n,"class","fa fa-envelope-o mr-1"),m(n,"aria-hidden","true"),m(e,"type","button"),m(e,"class","btn btn-outline-secondary text-dark bg-white dropdown-toggle"),m(e,"data-toggle","dropdown"),m(e,"data-bs-toggle","dropdown"),m(e,"aria-expanded","false"),e.disabled=l=!s[1].length,m(o,"class","dropdown-menu"),m(t,"class","btn-group ml-2 my-2")},m(r,a){y(r,t,a),g(t,e),g(e,n),g(e,i),g(e,u),g(t,f),g(t,o);for(let h=0;h<3;h+=1)b[h]&&b[h].m(o,null)},p(r,a){a&1&&d!==(d=r[0].sendmail+"")&&M(u,d),a&2&&l!==(l=!r[1].length)&&(e.disabled=l),a&9&&(p=I(["to","cc","bcc"]),b=J(b,a,c,1,r,p,_,o,O,D,null,E))},d(r){r&&k(t);for(let a=0;a<3;a+=1)b[a].d()}}}function D(s,t){let e,n=t[0][t[10]]+"",i,d,u,l;function f(){return t[8](t[10])}return{key:s,first:null,c(){e=w("button"),i=U(n),d=S(),m(e,"type","button"),m(e,"class","dropdown-item"),this.first=e},m(o,b){y(o,e,b),g(e,i),g(e,d),u||(l=W(e,"click",f),u=!0)},p(o,b){t=o,b&1&&n!==(n=t[0][t[10]]+"")&&M(i,n)},d(o){o&&k(e),u=!1,l()}}}function A(s){let t,e=s[2]&&L(s);return{c(){e&&e.c(),t=H()},m(n,i){e&&e.m(n,i),y(n,t,i)},p(n,[i]){n[2]?e?e.p(n,i):(e=L(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:v,o:v,d(n){n&&k(t),e&&e.d(n)}}}function G(s,t,e){let n,{strings:i}=t,{courses:d}=t,{userid:u}=t,{courseid:l}=t,{form:f}=t,o=[];R(async()=>{(await q("core/pubsub")).subscribe("core/checkbox-toggleall:checkboxToggled",b),b()}),F(async()=>{(await q("core/pubsub")).unsubscribe("core/checkbox-toggleall:checkboxToggled",b)});const b=async()=>{e(1,o=[]);const c=new FormData(f);for(const r of c.keys()){const a=/^user(\d+)$/.exec(r);if(a){const h=parseInt(a[1]);h!=u&&o.push(h)}}},_=c=>{const r=document.createElement("form");r.method="POST",r.action=C((n==null?void 0:n.id)??0,[],c),r.style.display="none";const a=document.createElement("input");a.type="hidden",a.name="recipients",a.value=o.join(","),r.appendChild(a),document.body.appendChild(r),r.submit()},p=c=>_(c);return s.$$set=c=>{"strings"in c&&e(0,i=c.strings),"courses"in c&&e(4,d=c.courses),"userid"in c&&e(5,u=c.userid),"courseid"in c&&e(6,l=c.courseid),"form"in c&&e(7,f=c.form)},s.$$.update=()=>{s.$$.dirty&80&&e(2,n=d.find(c=>c.id==l))},[i,o,n,_,d,u,l,f,p]}class K extends T{constructor(t){super(),B(this,t,G,A,j,{strings:0,courses:4,userid:5,courseid:6,form:7})}}function N(s){let t,e,n,i=s[1].sendmail+"",d,u;return{c(){t=w("a"),e=w("i"),n=S(),d=U(i),m(e,"class","fa fa-envelope-o mr-1"),m(e,"aria-hidden","true"),m(t,"class","btn"),m(t,"role","button"),m(t,"href",u=C(s[3],[s[2]],"to"))},m(l,f){y(l,t,f),g(t,e),g(t,n),g(t,d)},p(l,f){f&2&&i!==(i=l[1].sendmail+"")&&M(d,i),f&12&&u!==(u=C(l[3],[l[2]],"to"))&&m(t,"href",u)},d(l){l&&k(t)}}}function Q(s){let t,e=s[2]!=s[0]&&s[4]&&N(s);return{c(){e&&e.c(),t=H()},m(n,i){e&&e.m(n,i),y(n,t,i)},p(n,[i]){n[2]!=n[0]&&n[4]?e?e.p(n,i):(e=N(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:v,o:v,d(n){n&&k(t),e&&e.d(n)}}}function V(s,t,e){let n,{userid:i}=t,{strings:d}=t,{courses:u}=t,{id:l}=t,{courseid:f}=t;return s.$$set=o=>{"userid"in o&&e(0,i=o.userid),"strings"in o&&e(1,d=o.strings),"courses"in o&&e(5,u=o.courses),"id"in o&&e(2,l=o.id),"courseid"in o&&e(3,f=o.courseid)},s.$$.update=()=>{s.$$.dirty&40&&e(4,n=u.find(o=>o.id==f))},[i,d,l,f,n,u]}class Y extends T{constructor(t){super(),B(this,t,V,Q,j,{userid:0,strings:1,courses:5,id:2,courseid:3})}}async function Z(){const s=window.local_mail_navbar_data;if(!s)return;x(s);const t=window.location.origin+window.location.pathname,e=new URLSearchParams(window.location.search);t==window.M.cfg.wwwroot+"/user/view.php"?$(s,parseInt(e.get("id")||""),parseInt(e.get("course")||"")):t==window.M.cfg.wwwroot+"/user/index.php"?P(s,parseInt(e.get("id")||"")):t==window.M.cfg.wwwroot+"/blocks/completion_progress/overview.php"&&P(s,parseInt(e.get("courseid")||""))}function x(s){const t=document.getElementById("local-mail-navbar");if(t){t.innerHTML="";const e=new X({target:t,props:{settings:s.settings,strings:s.strings,courses:s.courses,labels:s.labels,params:{courseid:s.courseid},loading:!1,onClick:n=>{window.location.href=z(n)},onComposeClick:n=>{window.location.href=C(n)},onCourseChange:n=>{e.$set({params:{courseid:n}})}}})}}function P(s,t){var i;const e=(i=document.querySelector("#formactionid"))==null?void 0:i.parentElement,n=document.querySelector("#participantsform");t&&e&&n&&new K({target:e,props:{userid:s.userid,strings:s.strings,courses:s.courses,courseid:t,form:document.querySelector("#participantsform")}})}function $(s,t,e){const n=document.querySelector(".userprofile .page-context-header");if(t&&e&&n){let i=n.querySelector(".header-button-group");i||(i=document.createElement("div"),i.classList.add("btn-group","header-button-group"),n.append(i)),new Y({target:i,props:{userid:s.userid,strings:s.strings,courses:s.courses,id:t,courseid:e}})}}Z();
//# sourceMappingURL=navigation-B1fmmdTo.js.map
