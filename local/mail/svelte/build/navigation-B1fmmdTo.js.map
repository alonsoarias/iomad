{"version":3,"file":"navigation-B1fmmdTo.js","sources":["../src/components/UserListSendButton.svelte","../src/components/UserProfileSendButton.svelte","../src/navigation.ts"],"sourcesContent":["<!--\nSPDX-FileCopyrightText: 2023-2024 Proyecto UNIMOODLE <direccion.area.estrategia.digital@uva.es>\nSPDX-FileCopyrightText: 2025 Albert Gasset <albertgasset@fsfe.org>\n\nSPDX-License-Identifier: GPL-3.0-or-later\n-->\n<svelte:options immutable={true} />\n\n<script lang=\"ts\">\n    import { onDestroy, onMount } from 'svelte';\n    import { loadModule, type CorePubSub } from '../lib/amd';\n    import type { Course, Strings } from '../lib/state';\n    import { createUrl } from '../lib/url';\n\n    export let strings: Strings;\n    export let courses: ReadonlyArray<Course>;\n    export let userid: number;\n    export let courseid: number;\n    export let form: HTMLFormElement;\n\n    $: course = courses.find((course) => course.id == courseid);\n    let recipients: number[] = [];\n\n    onMount(async () => {\n        const pubsub = await loadModule<CorePubSub>('core/pubsub');\n        pubsub.subscribe('core/checkbox-toggleall:checkboxToggled', updateRecipients);\n        updateRecipients();\n    });\n\n    onDestroy(async () => {\n        const pubsub = await loadModule<CorePubSub>('core/pubsub');\n        pubsub.unsubscribe('core/checkbox-toggleall:checkboxToggled', updateRecipients);\n    });\n\n    const updateRecipients = async () => {\n        recipients = [];\n        const formData = new FormData(form);\n        for (const name of formData.keys()) {\n            const match = /^user(\\d+)$/.exec(name);\n            if (match) {\n                const id = parseInt(match[1]);\n                if (id != userid) {\n                    recipients.push(id);\n                }\n            }\n        }\n    };\n\n    const createMessage = (role: string) => {\n        const form = document.createElement('form');\n        form.method = 'POST';\n        form.action = createUrl(course?.id ?? 0, [], role);\n        form.style.display = 'none'\n\n        const input = document.createElement('input');\n        input.type = 'hidden';\n        input.name = 'recipients';\n        input.value = recipients.join(',');\n        form.appendChild(input);\n\n        document.body.appendChild(form);\n\n        form.submit();\n    };\n</script>\n\n{#if course}\n    <div class=\"btn-group ml-2 my-2\">\n        <button\n            type=\"button\"\n            class=\"btn btn-outline-secondary text-dark bg-white dropdown-toggle\"\n            data-toggle=\"dropdown\"\n            data-bs-toggle=\"dropdown\"\n            aria-expanded=\"false\"\n            disabled={!recipients.length}\n        >\n            <i class=\"fa fa-envelope-o mr-1\" aria-hidden=\"true\" />\n            {strings.sendmail}\n        </button>\n        <div class=\"dropdown-menu\">\n            {#each ['to', 'cc', 'bcc'] as role (role)}\n                <button type=\"button\" class=\"dropdown-item\" on:click={() => createMessage(role)}>\n                    {strings[role]}\n                </button>\n            {/each}\n        </div>\n    </div>\n{/if}\n","<!--\nSPDX-FileCopyrightText: 2023-2024 Proyecto UNIMOODLE <direccion.area.estrategia.digital@uva.es>\n\nSPDX-License-Identifier: GPL-3.0-or-later\n-->\n<svelte:options immutable={true} />\n\n<script lang=\"ts\">\n    import type { Course, Strings } from '../lib/state';\n    import { createUrl } from '../lib/url';\n\n    export let userid: number;\n    export let strings: Strings;\n    export let courses: ReadonlyArray<Course>;\n    export let id: number;\n    export let courseid: number;\n\n    $: course = courses.find((course) => course.id == courseid);\n</script>\n\n{#if id != userid && course}\n    <a class=\"btn\" role=\"button\" href={createUrl(courseid, [id], 'to')}>\n        <i class=\"fa fa-envelope-o mr-1\" aria-hidden=\"true\" />\n        {strings.sendmail}\n    </a>\n{/if}\n","/*\n * SPDX-FileCopyrightText: 2023-2024 Proyecto UNIMOODLE <direccion.area.estrategia.digital@uva.es>\n * SPDX-FileCopyrightText: 2024 Albert Gasset <albertgasset@fsfe.org>\n *\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\n\nimport Navbar from './components/Navbar.svelte';\nimport UserListSendButton from './components/UserListSendButton.svelte';\nimport UserProfileSendButton from './components/UserProfileSendButton.svelte';\nimport type { Course, Label, Settings, Strings, ViewParams } from './lib/state';\nimport { createUrl, viewUrl } from './lib/url';\nimport './global.css';\n\nasync function init() {\n    // Get needed data from script tag, to avoid doing web service requests.\n    const data = window.local_mail_navbar_data;\n    if (!data) {\n        return;\n    }\n\n    initNavbar(data);\n\n    const url = window.location.origin + window.location.pathname;\n    const params = new URLSearchParams(window.location.search);\n\n    if (url == window.M.cfg.wwwroot + '/user/view.php') {\n        initUserProfile(\n            data,\n            parseInt(params.get('id') || ''),\n            parseInt(params.get('course') || ''),\n        );\n    } else if (url == window.M.cfg.wwwroot + '/user/index.php') {\n        initUserList(data, parseInt(params.get('id') || ''));\n    } else if (url == window.M.cfg.wwwroot + '/blocks/completion_progress/overview.php') {\n        initUserList(data, parseInt(params.get('courseid') || ''));\n    }\n}\n\nfunction initNavbar(data: Record<string, unknown>) {\n    const target = document.getElementById('local-mail-navbar');\n    if (target) {\n        // Remove fallback link created in local_mail_render_navbar_output.\n        target.innerHTML = '';\n\n        const navbar = new Navbar({\n            target,\n            props: {\n                settings: data.settings as Settings,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                labels: data.labels as Label[],\n                params: { courseid: data.courseid as number },\n                loading: false,\n                onClick: (params: ViewParams) => {\n                    window.location.href = viewUrl(params);\n                },\n                onComposeClick: (courseid?: number) => {\n                    window.location.href = createUrl(courseid);\n                },\n                onCourseChange: (courseid?: number) => {\n                    navbar.$set({ params: { courseid } });\n                },\n            },\n        });\n    }\n}\n\nfunction initUserList(data: Record<string, unknown>, courseid: number) {\n    const target = document.querySelector('#formactionid')?.parentElement;\n    const form = document.querySelector('#participantsform') as HTMLFormElement;\n    if (courseid && target && form) {\n        new UserListSendButton({\n            target,\n            props: {\n                userid: data.userid as number,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                courseid,\n                form: document.querySelector('#participantsform') as HTMLFormElement,\n            },\n        });\n    }\n}\n\nfunction initUserProfile(data: Record<string, unknown>, id: number, courseid: number) {\n    const header = document.querySelector('.userprofile .page-context-header');\n    if (id && courseid && header) {\n        let target = header.querySelector('.header-button-group');\n        if (!target) {\n            target = document.createElement('div');\n            target.classList.add('btn-group', 'header-button-group');\n            header.append(target);\n        }\n        new UserProfileSendButton({\n            target,\n            props: {\n                userid: data.userid as number,\n                strings: data.strings as Strings,\n                courses: data.courses as Course[],\n                id,\n                courseid,\n            },\n        });\n    }\n}\n\ninit();\n"],"names":["t1_value","ctx","button","button_disabled_value","insert","target","div1","anchor","append","i","div0","dirty","set_data","t1","t0_value","t0","create_if_block","strings","$$props","courses","userid","courseid","form","recipients","onMount","loadModule","updateRecipients","onDestroy","$$invalidate","formData","name","match","id","createMessage","role","createUrl","course","input","click_handler","attr","a","a_href_value","init","data","initNavbar","url","params","initUserProfile","initUserList","navbar","Navbar","viewUrl","_a","UserListSendButton","header","UserProfileSendButton"],"mappings":"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"}