{{!
    @template local_jobboard/pages/apply

    Apply for vacancy page template.

    Context variables:
    * pageheader - Page header data
    * vacancy - Vacancy information
    * deadlinewarning - Warning if close to deadline
    * daysuntilclose - Days until closing
    * guidelines - Array of application guideline strings
    * isexemption - Boolean if user has exemption
    * exemptioninfo - Exemption details if applicable
    * requireddocs - Array of required documents
    * form - Moodle form HTML

    Example context (json):
    {
        "vacancy": {"id": 1, "title": "Developer"},
        "daysuntilclose": 5,
        "deadlinewarning": true
    }
}}
<div class="local-jobboard-apply" data-region="jobboard-apply">
    {{! Page Header }}
    {{> local_jobboard/components/page_header }}

    <div class="row">
        {{! Left Column - Form }}
        <div class="col-lg-8">
            {{! Deadline Warning }}
            {{#deadlinewarning}}
            <div class="alert alert-warning mb-4">
                <i class="fa fa-exclamation-triangle mr-2"></i>
                {{#str}}deadlinewarning, local_jobboard, {{daysuntilclose}}{{/str}}
            </div>
            {{/deadlinewarning}}

            {{! Exemption Info }}
            {{#isexemption}}
            <div class="alert alert-info mb-4">
                <i class="fa fa-info-circle mr-2"></i>
                <strong>{{#str}}exemptionapplied, local_jobboard{{/str}}</strong>
                <p class="mb-0 mt-2">
                    {{#str}}exemptiontype, local_jobboard{{/str}}: {{exemptioninfo.type}}<br>
                    {{#exemptioninfo.documentref}}
                    {{#str}}documentref, local_jobboard{{/str}}: {{exemptioninfo.documentref}}
                    {{/exemptioninfo.documentref}}
                </p>
            </div>
            {{/isexemption}}

            {{! Guidelines Card }}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fa fa-info-circle mr-2"></i>
                        {{#str}}applicationguidelines, local_jobboard{{/str}}
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        {{#guidelines}}
                        <li>{{.}}</li>
                        {{/guidelines}}
                    </ul>
                </div>
            </div>

            {{! Required Documents Card }}
            {{#requireddocs.0}}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fa fa-file-alt mr-2"></i>
                        {{#str}}requireddocuments, local_jobboard{{/str}}
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {{#requireddocs}}
                        <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <strong>{{name}}</strong>
                                {{#description}}
                                <small class="text-muted d-block">{{description}}</small>
                                {{/description}}
                            </div>
                            {{#isrequired}}
                            <span class="badge badge-danger">{{#str}}required, local_jobboard{{/str}}</span>
                            {{/isrequired}}
                            {{^isrequired}}
                            <span class="badge badge-secondary">{{#str}}optional, local_jobboard{{/str}}</span>
                            {{/isrequired}}
                        </li>
                        {{/requireddocs}}
                    </ul>
                </div>
            </div>
            {{/requireddocs.0}}

            {{! Application Form Card }}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fa fa-edit mr-2"></i>
                        {{#str}}applicationform, local_jobboard{{/str}}
                    </h5>
                </div>
                <div class="card-body">
                    {{{form}}}
                </div>
            </div>
        </div>

        {{! Right Column - Vacancy Info }}
        <div class="col-lg-4">
            {{! Vacancy Summary Card }}
            <div class="card shadow-sm mb-4 sticky-top" style="top: 1rem; z-index: 100;">
                <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">
                        <i class="fa fa-briefcase mr-2"></i>
                        {{#str}}vacancysummary, local_jobboard{{/str}}
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-1">
                        <strong>{{vacancy.title}}</strong>
                    </p>
                    <p class="text-muted small mb-2">
                        <span class="badge badge-secondary">{{vacancy.code}}</span>
                    </p>

                    {{#vacancy.location}}
                    <p class="small mb-1">
                        <i class="fa fa-map-marker-alt text-muted mr-2"></i>{{vacancy.location}}
                    </p>
                    {{/vacancy.location}}

                    {{#vacancy.contracttypelabel}}
                    <p class="small mb-1">
                        <i class="fa fa-briefcase text-muted mr-2"></i>{{vacancy.contracttypelabel}}
                    </p>
                    {{/vacancy.contracttypelabel}}

                    <p class="small mb-2">
                        <i class="fa fa-users text-muted mr-2"></i>
                        {{#str}}positions, local_jobboard{{/str}}: {{vacancy.positions}}
                    </p>

                    <hr>

                    <p class="small mb-1 {{#vacancy.isurgent}}text-warning{{/vacancy.isurgent}}">
                        <i class="fa fa-calendar-times mr-2"></i>
                        {{#str}}closedate, local_jobboard{{/str}}: <strong>{{vacancy.closedateformatted}}</strong>
                    </p>

                    {{#vacancy.isurgent}}
                    <div class="alert alert-warning py-2 px-3 mb-0 small">
                        <i class="fa fa-exclamation-triangle mr-1"></i>
                        {{#str}}closesin, local_jobboard, {{vacancy.daysremaining}}{{/str}}
                    </div>
                    {{/vacancy.isurgent}}
                </div>

                {{#vacancy.viewurl}}
                <div class="card-footer bg-light">
                    <a href="{{vacancy.viewurl}}" class="btn btn-sm btn-outline-secondary btn-block">
                        <i class="fa fa-eye mr-1"></i>
                        {{#str}}viewvacancy, local_jobboard{{/str}}
                    </a>
                </div>
                {{/vacancy.viewurl}}
            </div>

            {{! Help Card }}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fa fa-question-circle mr-2"></i>
                        {{#str}}needhelp, local_jobboard{{/str}}
                    </h6>
                </div>
                <div class="card-body">
                    <p class="small text-muted mb-2">
                        {{#str}}applicationhelptext, local_jobboard{{/str}}
                    </p>
                    {{#helpcontactemail}}
                    <a href="mailto:{{helpcontactemail}}" class="btn btn-sm btn-outline-primary btn-block">
                        <i class="fa fa-envelope mr-1"></i>
                        {{#str}}contactus, local_jobboard{{/str}}
                    </a>
                    {{/helpcontactemail}}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.local-jobboard-apply .mform {
    max-width: 100%;
}
.local-jobboard-apply .fitem {
    margin-bottom: 1.25rem;
}
.local-jobboard-apply .filepicker-container {
    border: 2px dashed #dee2e6;
    border-radius: 0.5rem;
    padding: 1rem;
    background: #f8f9fa;
}
</style>
