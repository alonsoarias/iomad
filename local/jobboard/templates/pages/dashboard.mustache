{{!
    @template local_jobboard/pages/dashboard

    Main dashboard page template.

    Context variables:
    * pageheader - Page header data for page_header partial
    * isadmin - Boolean if user is admin/manager
    * isreviewer - Boolean if user can review
    * isapplicant - Boolean if user can apply
    * stats - Array of stat cards for admin section
    * applicantstats - Array of stat cards for applicant section
    * adminsections - Array of admin section cards
    * applicantsections - Array of applicant section cards
    * reviewersection - Reviewer section data
    * alerts - Array of alert messages

    Example context (json):
    {
        "isadmin": true,
        "stats": [{"value": "5", "label": "Active Calls", "icon": "folder-open", "color": "primary"}]
    }
}}
<div class="local-jobboard-dashboard" data-region="jobboard-dashboard">
    {{! Page Header }}
    {{> local_jobboard/components/page_header }}

    {{! Alerts }}
    {{#alerts.0}}
    <div class="mb-4">
        {{#alerts}}
        <div class="alert alert-{{type}} alert-dismissible fade show" role="alert">
            {{#icon}}
            <i class="fa fa-{{icon}} mr-2"></i>
            {{/icon}}
            {{{message}}}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {{/alerts}}
    </div>
    {{/alerts.0}}

    {{! Admin/Manager Section }}
    {{#isadmin}}
    <div class="jb-admin-section mb-5">
        <h4 class="text-muted mb-3">
            <i class="fa fa-cog mr-2"></i>
            {{#str}}administracion, local_jobboard{{/str}}
        </h4>

        {{! Statistics Row }}
        {{#stats.0}}
        <div class="row mb-4">
            {{#stats}}
            <div class="col-lg-3 col-md-6 mb-3">
                {{> local_jobboard/components/stat_card }}
            </div>
            {{/stats}}
        </div>
        {{/stats.0}}

        {{! Admin Action Cards }}
        <div class="row">
            {{#adminsections}}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 shadow-sm jb-section-card">
                    <div class="card-header bg-{{color}} text-white">
                        <h5 class="mb-0">
                            <i class="fa fa-{{icon}} mr-2"></i>
                            {{title}}
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">{{description}}</p>
                        {{#features.0}}
                        <ul class="list-unstyled small text-muted mb-3">
                            {{#features}}
                            <li class="mb-1">
                                <i class="fa fa-check text-{{../color}} mr-1"></i>
                                {{.}}
                            </li>
                            {{/features}}
                        </ul>
                        {{/features.0}}
                    </div>
                    <div class="card-footer bg-white border-top-0">
                        <a href="{{url}}" class="btn btn-{{color}} btn-block">
                            {{buttonlabel}}
                            <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
            {{/adminsections}}
        </div>
    </div>
    {{/isadmin}}

    {{! Reviewer Section }}
    {{#isreviewer}}
    <div class="jb-reviewer-section mb-5">
        <h4 class="text-muted mb-3">
            <i class="fa fa-clipboard-check mr-2"></i>
            {{#str}}reviewertasks, local_jobboard{{/str}}
        </h4>

        <div class="row">
            <div class="col-lg-8">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fa fa-tasks mr-2"></i>
                            {{#str}}myreviews, local_jobboard{{/str}}
                        </h5>
                        {{#reviewersection.pendingcount}}
                        <span class="badge badge-warning">{{reviewersection.pendingcount}} {{#str}}pending, local_jobboard{{/str}}</span>
                        {{/reviewersection.pendingcount}}
                    </div>
                    <div class="card-body">
                        <p class="text-muted">{{#str}}myreviews_desc, local_jobboard{{/str}}</p>
                        {{#reviewersection.haspendingreview}}
                        <div class="alert alert-warning">
                            <i class="fa fa-exclamation-triangle mr-1"></i>
                            {{#str}}pending_reviews_alert, local_jobboard, {{reviewersection.pendingcount}}{{/str}}
                        </div>
                        {{/reviewersection.haspendingreview}}
                    </div>
                    <div class="card-footer bg-white">
                        <a href="{{reviewersection.url}}" class="btn btn-info">
                            {{#str}}viewmyreviews, local_jobboard{{/str}}
                            <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card shadow-sm h-100 bg-light">
                    <div class="card-body text-center">
                        <i class="fa fa-chart-pie fa-3x text-info mb-3"></i>
                        <h3 class="mb-1">{{reviewersection.completedcount}}</h3>
                        <p class="text-muted mb-0">{{#str}}completedreviews, local_jobboard{{/str}}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{/isreviewer}}

    {{! Applicant Section }}
    {{#isapplicant}}
    <div class="jb-applicant-section">
        <h4 class="text-muted mb-3">
            <i class="fa fa-user mr-2"></i>
            {{#str}}myapplications, local_jobboard{{/str}}
        </h4>

        {{! Applicant Statistics }}
        {{#applicantstats.0}}
        <div class="row mb-4">
            {{#applicantstats}}
            <div class="col-lg-3 col-md-6 mb-3">
                {{> local_jobboard/components/stat_card }}
            </div>
            {{/applicantstats}}
        </div>
        {{/applicantstats.0}}

        {{! Applicant Action Cards }}
        <div class="row">
            {{#applicantsections}}
            <div class="col-lg-6 mb-4">
                <div class="card h-100 shadow-sm jb-section-card">
                    <div class="card-header bg-{{color}} text-white">
                        <h5 class="mb-0">
                            <i class="fa fa-{{icon}} mr-2"></i>
                            {{title}}
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">{{description}}</p>
                        {{#alert}}
                        <div class="alert alert-{{alerttype}}">
                            <i class="fa fa-info-circle mr-1"></i>
                            {{alert}}
                        </div>
                        {{/alert}}
                    </div>
                    <div class="card-footer bg-white border-top-0">
                        <a href="{{url}}" class="btn btn-{{color}}">
                            {{buttonlabel}}
                            <i class="fa fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
            {{/applicantsections}}
        </div>
    </div>
    {{/isapplicant}}
</div>

{{#js}}
require(['jquery'], function($) {
    // Dashboard animations
    $('.jb-stat-card').each(function(index) {
        $(this).css('opacity', 0).delay(index * 100).animate({opacity: 1}, 300);
    });

    // Section card hover effects
    $('.jb-section-card').hover(
        function() { $(this).addClass('shadow'); },
        function() { $(this).removeClass('shadow'); }
    );
});
{{/js}}
