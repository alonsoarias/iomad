{{!
    @template local_jobboard/pages/convocatoria

    Single convocatoria create/edit page template.
    Uses jb-* CSS classes for consistent styling.

    Context variables:
    * pagetitle - Page title string
    * breadcrumbs - Array of breadcrumb items
    * isediting - Boolean if editing existing
    * convocatoria - Convocatoria data if editing
    * stats - Statistics cards (vacancies, applications, status)
    * vacancies - Array of vacancies in this convocatoria (max 5)
    * hasvacancies - Boolean if has vacancies
    * vacancycount - Total vacancy count
    * applicationcount - Total application count
    * canaddvacancy - Boolean if can add vacancy
    * addvacancyurl - URL to add vacancy
    * viewallurl - URL to view all vacancies
    * applicationsurl - URL to view applications
    * showviewall - Boolean if should show view all link
    * formhtml - Moodle form HTML
    * backurl - URL to go back to convocatorias list
    * dashboardurl - URL to dashboard

    Example context (json):
    {
        "isediting": true,
        "convocatoria": {"id": 1, "name": "Call 2025"}
    }
}}
<div class="jb-convocatoria-edit" data-region="jobboard-convocatoria-edit">
    {{! Breadcrumbs }}
    {{#breadcrumbs.0}}
    <nav aria-label="{{#str}}breadcrumb{{/str}}" class="jb-mb-3">
        <ol class="jb-breadcrumb">
            {{#breadcrumbs}}
            <li class="jb-breadcrumb-item {{#active}}jb-active{{/active}}">
                {{#url}}
                <a href="{{url}}">{{label}}</a>
                {{/url}}
                {{^url}}
                <span>{{label}}</span>
                {{/url}}
            </li>
            {{/breadcrumbs}}
        </ol>
    </nav>
    {{/breadcrumbs.0}}

    {{! Page Header }}
    <header class="jb-page-header jb-d-flex jb-justify-content-between jb-align-items-center jb-mb-4">
        <h1 class="jb-fs-3 jb-mb-0">{{pagetitle}}</h1>
        <a href="{{backurl}}" class="jb-btn jb-btn-outline-secondary">
            <i class="fa fa-arrow-left jb-mr-2" aria-hidden="true"></i>
            {{#str}}backtoconvocatorias, local_jobboard{{/str}}
        </a>
    </header>

    {{#isediting}}
    {{! Statistics Row }}
    {{#hasstats}}
    <section class="jb-row jb-mb-4" aria-label="{{#str}}statistics, local_jobboard{{/str}}">
        {{#stats}}
        <div class="jb-col-lg-4 jb-col-md-6 jb-mb-3">
            <div class="jb-card jb-card-shadow jb-stat-card jb-stat-card-{{color}}">
                <div class="jb-card-body jb-d-flex jb-align-items-center">
                    <div class="jb-stat-icon jb-mr-3">
                        <i class="fa fa-{{icon}}" aria-hidden="true"></i>
                    </div>
                    <div>
                        <div class="jb-stat-value jb-fs-3 jb-fw-bold">{{value}}</div>
                        <div class="jb-stat-label jb-small jb-text-muted">{{label}}</div>
                    </div>
                </div>
            </div>
        </div>
        {{/stats}}
    </section>
    {{/hasstats}}

    {{! Convocatoria Info Card }}
    <section class="jb-card jb-card-shadow jb-mb-4 jb-border-{{convocatoria.statuscolor}}" aria-labelledby="convocatoria-info-heading">
        <div class="jb-card-header jb-d-flex jb-justify-content-between jb-align-items-center jb-bg-{{convocatoria.statuscolor}} jb-text-white">
            <h2 class="jb-fs-5 jb-mb-0" id="convocatoria-info-heading">{{convocatoria.name}}</h2>
            <span class="jb-badge jb-badge-light">{{convocatoria.statuslabel}}</span>
        </div>
        <div class="jb-card-body">
            {{! Dates }}
            <div class="jb-row jb-mb-3">
                <div class="jb-col-md-6">
                    <small class="jb-d-block jb-text-muted">{{#str}}convocatoriastartdate, local_jobboard{{/str}}</small>
                    <strong>
                        <i class="fa fa-calendar-alt jb-text-success jb-mr-2" aria-hidden="true"></i>
                        {{convocatoria.startdateformatted}}
                    </strong>
                </div>
                <div class="jb-col-md-6">
                    <small class="jb-d-block jb-text-muted">{{#str}}convocatoriaenddate, local_jobboard{{/str}}</small>
                    <strong>
                        <i class="fa fa-calendar-times jb-text-danger jb-mr-2" aria-hidden="true"></i>
                        {{convocatoria.enddateformatted}}
                    </strong>
                </div>
            </div>

            {{! Action Buttons }}
            <div class="jb-d-flex jb-flex-wrap">
                {{#canaddvacancy}}
                <a href="{{addvacancyurl}}" class="jb-btn jb-btn-success jb-mr-2 jb-mb-2">
                    <i class="fa fa-plus jb-mr-2" aria-hidden="true"></i>
                    {{#str}}addvacancy, local_jobboard{{/str}}
                </a>
                {{/canaddvacancy}}

                {{#hasvacancies}}
                <a href="{{viewallurl}}" class="jb-btn jb-btn-info jb-mr-2 jb-mb-2">
                    <i class="fa fa-list jb-mr-2" aria-hidden="true"></i>
                    {{#str}}viewvacancies, local_jobboard{{/str}} ({{vacancycount}})
                </a>
                {{/hasvacancies}}

                {{#hasapplications}}
                <a href="{{applicationsurl}}" class="jb-btn jb-btn-outline-info jb-mr-2 jb-mb-2">
                    <i class="fa fa-file-alt jb-mr-2" aria-hidden="true"></i>
                    {{#str}}applications, local_jobboard{{/str}} ({{applicationcount}})
                </a>
                {{/hasapplications}}
            </div>
        </div>
    </section>

    {{! Vacancies List Card }}
    {{#hasvacancies}}
    <section class="jb-card jb-card-shadow jb-mb-4" aria-labelledby="vacancies-heading">
        <div class="jb-card-header jb-bg-white jb-fw-bold">
            <i class="fa fa-briefcase jb-mr-2" aria-hidden="true"></i>
            <span id="vacancies-heading">{{#str}}vacancies, local_jobboard{{/str}}</span>
            <span class="jb-badge jb-badge-primary jb-ml-2">{{vacancycount}}</span>
        </div>
        <div class="jb-card-body jb-p-0">
            <ul class="jb-list-group jb-list-group-flush">
                {{#vacancies}}
                <li class="jb-list-group-item jb-d-flex jb-justify-content-between jb-align-items-center">
                    <div>
                        <span class="jb-badge jb-badge-secondary jb-mr-2">{{code}}</span>
                        <strong>{{title}}</strong>
                        <span class="jb-badge jb-badge-{{statuscolor}} jb-ml-2">{{statuslabel}}</span>
                    </div>
                    <div class="jb-d-flex jb-align-items-center">
                        <span class="jb-badge jb-badge-info jb-mr-2" title="{{#str}}applications, local_jobboard{{/str}}">
                            <i class="fa fa-file-alt jb-mr-1" aria-hidden="true"></i>{{applicationcount}}
                        </span>
                        <a href="{{editurl}}" class="jb-btn jb-btn-sm jb-btn-outline-primary" aria-label="{{#str}}edit{{/str}} {{title}}">
                            <i class="fa fa-edit" aria-hidden="true"></i>
                        </a>
                    </div>
                </li>
                {{/vacancies}}

                {{#showviewall}}
                <li class="jb-list-group-item jb-text-center">
                    <a href="{{viewallurl}}" class="jb-btn jb-btn-sm jb-btn-outline-secondary">
                        {{#str}}viewall, local_jobboard{{/str}} ({{vacancycount}})
                    </a>
                </li>
                {{/showviewall}}
            </ul>
        </div>
    </section>
    {{/hasvacancies}}
    {{/isediting}}

    {{! Form Card }}
    <section class="jb-card jb-card-shadow jb-mb-4" aria-labelledby="form-heading">
        <div class="jb-card-header jb-bg-primary jb-text-white jb-fw-bold">
            <i class="fa fa-edit jb-mr-2" aria-hidden="true"></i>
            <span id="form-heading">
                {{#isediting}}
                {{#str}}editconvocatoria, local_jobboard{{/str}}
                {{/isediting}}
                {{^isediting}}
                {{#str}}addconvocatoria, local_jobboard{{/str}}
                {{/isediting}}
            </span>
        </div>
        <div class="jb-card-body">
            {{{formhtml}}}
        </div>
    </section>

    {{! Navigation Footer }}
    <footer class="jb-navigation-footer jb-d-flex jb-justify-content-between jb-align-items-center jb-mt-4 jb-py-3 jb-border-top">
        <a href="{{backurl}}" class="jb-btn jb-btn-outline-secondary">
            <i class="fa fa-arrow-left jb-mr-2" aria-hidden="true"></i>
            {{#str}}backtoconvocatorias, local_jobboard{{/str}}
        </a>
        <a href="{{dashboardurl}}" class="jb-btn jb-btn-link jb-text-muted">
            {{#str}}backtodashboard, local_jobboard{{/str}}
            <i class="fa fa-arrow-right jb-ml-2" aria-hidden="true"></i>
        </a>
    </footer>
</div>
