{{!
    @template local_jobboard/pages/review/assign_reviewer

    Assign reviewer to applications page template.
    Uses jb-* CSS classes for consistent styling.
    Includes accessibility features, animations, and loading states.

    Context variables:
    * pagetitle - Page title string
    * stats - Statistics object (unassigned, reviewers, assigned, avgworkload)
    * vacancies - Vacancies for filter dropdown
    * selectedvacancyid - Currently selected vacancy ID
    * reviewers - Available reviewers with workload
    * hasreviewers - Boolean if has reviewers
    * unassigned - Unassigned applications list
    * hasunassigned - Boolean if has unassigned
    * filterformurl - URL for filter form
    * actionformurl - URL for action form
    * dashboardurl - URL to dashboard
    * reviewurl - URL to review applications
    * bulkvalidateurl - URL to bulk validation
    * sesskey - Session key
    * loading - bool - Show skeleton loading state

    Example context (json):
    {
        "pagetitle": "Assign Reviewer",
        "stats": {"unassigned": 10, "reviewers": 5, "assigned": 25, "avgworkload": 5.0}
    }
}}
{{#loading}}
{{! Skeleton Loading State }}
<div class="jb-assign-reviewer" aria-busy="true" aria-label="{{#str}}loading{{/str}}">
    <div class="jb-d-flex jb-justify-content-between jb-mb-4">
        <div class="jb-skeleton-title" style="width: 200px;"></div>
        <div class="jb-skeleton-text" style="width: 250px; height: 38px;"></div>
    </div>
    <div class="jb-row jb-mb-4">
        <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3"><div class="jb-skeleton-text" style="height: 100px;"></div></div>
        <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3"><div class="jb-skeleton-text" style="height: 100px;"></div></div>
        <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3"><div class="jb-skeleton-text" style="height: 100px;"></div></div>
        <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3"><div class="jb-skeleton-text" style="height: 100px;"></div></div>
    </div>
    <div class="jb-skeleton-text jb-mb-4" style="height: 60px;"></div>
    <div class="jb-skeleton-text jb-mb-4" style="height: 200px;"></div>
    <div class="jb-skeleton-text" style="height: 300px;"></div>
</div>
{{/loading}}

{{^loading}}
<div class="jb-assign-reviewer" data-region="jobboard-assign-reviewer">
    {{! Skip Link for Accessibility }}
    <a href="#assign-reviewer-content" class="jb-skip-link">
        {{#str}}skiptocontent, local_jobboard{{/str}}
    </a>

    {{! Page Header }}
    <header class="jb-page-header jb-d-flex jb-justify-content-between jb-align-items-center jb-mb-4 jb-fade-in">
        <h1 class="jb-fs-3 jb-mb-0">
            <i class="fa fa-user-plus jb-text-primary jb-mr-2" aria-hidden="true"></i>
            {{pagetitle}}
        </h1>
        <div class="jb-btn-group">
            <a href="{{dashboardurl}}" class="jb-btn jb-btn-outline-secondary jb-hover-lift">
                <i class="fa fa-gauge jb-mr-2" aria-hidden="true"></i>
                {{#str}}dashboard, local_jobboard{{/str}}
            </a>
            <a href="{{reviewurl}}" class="jb-btn jb-btn-outline-primary jb-hover-lift">
                <i class="fa fa-clipboard-check jb-mr-2" aria-hidden="true"></i>
                {{#str}}reviewapplications, local_jobboard{{/str}}
            </a>
        </div>
    </header>

    <main id="assign-reviewer-content">
        {{! Statistics Cards }}
        <section class="jb-row jb-mb-4" role="region" aria-label="{{#str}}statistics, local_jobboard{{/str}}">
            <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3">
                <div class="jb-card jb-card-shadow jb-stat-card jb-stat-card-warning jb-fade-in-up" style="animation-delay: 0.05s;">
                    <div class="jb-card-body jb-d-flex jb-align-items-center">
                        <div class="jb-stat-icon jb-mr-3">
                            <i class="fa fa-triangle-exclamation" aria-hidden="true"></i>
                        </div>
                        <div>
                            <div class="jb-stat-value jb-fs-3 jb-fw-bold">{{stats.unassigned}}</div>
                            <div class="jb-stat-label jb-small jb-text-muted">{{#str}}unassignedapplications, local_jobboard{{/str}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3">
                <div class="jb-card jb-card-shadow jb-stat-card jb-stat-card-primary jb-fade-in-up" style="animation-delay: 0.1s;">
                    <div class="jb-card-body jb-d-flex jb-align-items-center">
                        <div class="jb-stat-icon jb-mr-3">
                            <i class="fa fa-users" aria-hidden="true"></i>
                        </div>
                        <div>
                            <div class="jb-stat-value jb-fs-3 jb-fw-bold">{{stats.reviewers}}</div>
                            <div class="jb-stat-label jb-small jb-text-muted">{{#str}}availablereviewers, local_jobboard{{/str}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3">
                <div class="jb-card jb-card-shadow jb-stat-card jb-stat-card-success jb-fade-in-up" style="animation-delay: 0.15s;">
                    <div class="jb-card-body jb-d-flex jb-align-items-center">
                        <div class="jb-stat-icon jb-mr-3">
                            <i class="fa fa-circle-check" aria-hidden="true"></i>
                        </div>
                        <div>
                            <div class="jb-stat-value jb-fs-3 jb-fw-bold">{{stats.assigned}}</div>
                            <div class="jb-stat-label jb-small jb-text-muted">{{#str}}totalassigned, local_jobboard{{/str}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jb-col-lg-3 jb-col-md-6 jb-mb-3">
                <div class="jb-card jb-card-shadow jb-stat-card jb-stat-card-info jb-fade-in-up" style="animation-delay: 0.2s;">
                    <div class="jb-card-body jb-d-flex jb-align-items-center">
                        <div class="jb-stat-icon jb-mr-3">
                            <i class="fa fa-chart-bar" aria-hidden="true"></i>
                        </div>
                        <div>
                            <div class="jb-stat-value jb-fs-3 jb-fw-bold">{{stats.avgworkload}}</div>
                            <div class="jb-stat-label jb-small jb-text-muted">{{#str}}avgworkload, local_jobboard{{/str}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        {{! Vacancy Filter }}
        <section class="jb-card jb-card-shadow jb-mb-4 jb-fade-in-up" style="animation-delay: 0.25s;" aria-label="{{#str}}filter{{/str}}">
            <div class="jb-card-body">
                <form method="get" action="{{filterformurl}}" class="jb-form-inline jb-flex-wrap jb-align-items-center">
                    <div class="jb-form-group jb-mr-3 jb-mb-2">
                        <label class="jb-sr-only" for="vacancyid">{{#str}}vacancy, local_jobboard{{/str}}</label>
                        <select name="vacancyid" id="vacancyid" class="jb-form-control">
                            <option value="0">{{#str}}allvacancies, local_jobboard{{/str}}</option>
                            {{#vacancies}}
                            <option value="{{id}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                            {{/vacancies}}
                        </select>
                    </div>
                    <button type="submit" class="jb-btn jb-btn-primary jb-mb-2 jb-hover-lift">
                        <i class="fa fa-filter jb-mr-1" aria-hidden="true"></i>
                        {{#str}}filter{{/str}}
                    </button>
                </form>
            </div>
        </section>

        {{! Reviewer Workload Summary }}
        <section class="jb-card jb-card-shadow jb-mb-4 jb-fade-in-up" style="animation-delay: 0.3s;" aria-labelledby="workload-heading">
            <div class="jb-card-header jb-bg-white jb-d-flex jb-justify-content-between jb-align-items-center">
                <h5 class="jb-mb-0" id="workload-heading">
                    <i class="fa fa-users jb-text-primary jb-mr-2" aria-hidden="true"></i>
                    {{#str}}reviewerworkload, local_jobboard{{/str}}
                </h5>
                <span class="jb-badge jb-badge-secondary">{{stats.reviewers}} {{#str}}reviewers, local_jobboard{{/str}}</span>
            </div>
            <div class="jb-card-body">
                {{#hasreviewers}}
                <div class="jb-row">
                    {{#reviewers}}
                    <div class="jb-col-lg-4 jb-col-md-6 jb-mb-3">
                        <div class="jb-card jb-h-100 jb-border-left-{{workloadcolor}} jb-fade-in" style="animation-delay: calc(0.35s + {{@index}} * 0.03s);">
                            <div class="jb-card-body">
                                <h6 class="jb-mb-2">
                                    <i class="fa fa-user jb-text-muted jb-mr-2" aria-hidden="true"></i>
                                    {{fullname}}
                                </h6>
                                <span class="jb-badge jb-badge-{{workloadcolor}} jb-mb-2">
                                    {{workload}} {{#str}}activeassignments, local_jobboard{{/str}}
                                </span>
                                {{#hasstats}}
                                <div class="jb-small jb-text-muted jb-mt-2">
                                    <i class="fa fa-check jb-mr-1" aria-hidden="true"></i>
                                    {{#str}}reviewed, local_jobboard{{/str}}: <strong>{{stats.reviewed}}</strong>
                                    <span class="jb-mx-2">|</span>
                                    <i class="fa fa-clock jb-mr-1" aria-hidden="true"></i>
                                    {{#str}}avgtime, local_jobboard{{/str}}: <strong>{{stats.avgtime}}h</strong>
                                </div>
                                {{/hasstats}}
                            </div>
                        </div>
                    </div>
                    {{/reviewers}}
                </div>
                {{/hasreviewers}}
                {{^hasreviewers}}
                <div class="jb-empty-state jb-text-center jb-py-4">
                    <div class="jb-icon-circle jb-bg-light jb-text-muted jb-mx-auto jb-mb-3" style="width: 60px; height: 60px;">
                        <i class="fa fa-users fa-lg" aria-hidden="true"></i>
                    </div>
                    <p class="jb-text-muted jb-mb-0">{{#str}}noreviewers, local_jobboard{{/str}}</p>
                </div>
                {{/hasreviewers}}
            </div>
        </section>

        {{! Auto-Assign Section }}
        <section class="jb-card jb-card-shadow jb-mb-4 jb-border-info jb-fade-in-up" style="animation-delay: 0.35s;" aria-labelledby="autoassign-heading">
            <div class="jb-card-header jb-bg-info jb-text-white">
                <h5 class="jb-mb-0" id="autoassign-heading">
                    <i class="fa fa-wand-magic-sparkles jb-mr-2" aria-hidden="true"></i>
                    {{#str}}autoassign, local_jobboard{{/str}}
                </h5>
            </div>
            <div class="jb-card-body">
                <form method="post" action="{{actionformurl}}" class="jb-d-flex jb-flex-wrap jb-align-items-center">
                    <input type="hidden" name="sesskey" value="{{sesskey}}">
                    <input type="hidden" name="action" value="autoassign">
                    <input type="hidden" name="vacancyid" value="{{selectedvacancyid}}">
                    <div class="jb-form-group jb-mr-3 jb-mb-2">
                        <label for="maxperreviewer" class="jb-mr-2">{{#str}}maxperreviewer, local_jobboard{{/str}}</label>
                        <input type="number" name="maxperreviewer" id="maxperreviewer" value="20"
                               min="1" max="100" class="jb-form-control jb-narrow-input">
                    </div>
                    <button type="submit" class="jb-btn jb-btn-light jb-mb-2 jb-hover-lift">
                        <i class="fa fa-wand-magic-sparkles jb-mr-2" aria-hidden="true"></i>
                        {{#str}}autoassignall, local_jobboard{{/str}}
                    </button>
                </form>
                <small class="jb-text-muted jb-mt-2 jb-d-block">
                    <i class="fa fa-circle-info jb-mr-1" aria-hidden="true"></i>
                    {{#str}}autoassignhelp, local_jobboard{{/str}}
                </small>
            </div>
        </section>

        {{! Manual Assignment Section }}
        <section class="jb-card jb-card-shadow jb-mb-4 jb-fade-in-up" style="animation-delay: 0.4s;" aria-labelledby="manual-heading">
            <div class="jb-card-header jb-bg-white jb-d-flex jb-justify-content-between jb-align-items-center">
                <h5 class="jb-mb-0" id="manual-heading">
                    <i class="fa fa-hand-pointer jb-text-primary jb-mr-2" aria-hidden="true"></i>
                    {{#str}}manualassign, local_jobboard{{/str}}
                </h5>
                <span class="jb-badge jb-badge-warning">{{stats.unassigned}} {{#str}}pendingassignment, local_jobboard{{/str}}</span>
            </div>
            <div class="jb-card-body">
                {{#hasunassigned}}
                <form method="post" action="{{actionformurl}}" id="manual-assign-form">
                    <input type="hidden" name="sesskey" value="{{sesskey}}">
                    <input type="hidden" name="action" value="assign">
                    <input type="hidden" name="vacancyid" value="{{selectedvacancyid}}">

                    {{! Reviewer Selection }}
                    <div class="jb-row jb-mb-4">
                        <div class="jb-col-md-6">
                            <div class="jb-form-group">
                                <label for="reviewerid" class="jb-form-label jb-fw-bold">
                                    <i class="fa fa-user-plus jb-mr-2" aria-hidden="true"></i>
                                    {{#str}}assignto, local_jobboard{{/str}}
                                </label>
                                <select name="reviewerid" id="reviewerid" class="jb-form-control" required>
                                    <option value="">{{#str}}selectreviewer, local_jobboard{{/str}}</option>
                                    {{#reviewers}}
                                    <option value="{{id}}">{{fullname}} ({{workload}} {{#str}}assigned, local_jobboard{{/str}}){{workloadindicator}}</option>
                                    {{/reviewers}}
                                </select>
                            </div>
                        </div>
                    </div>

                    {{! Select All Checkbox }}
                    <div class="jb-custom-control jb-custom-checkbox jb-mb-3">
                        <input type="checkbox" class="jb-custom-control-input" id="selectallapp">
                        <label class="jb-custom-control-label jb-fw-bold" for="selectallapp">{{#str}}selectall{{/str}}</label>
                    </div>

                    {{! Applications Table }}
                    <div class="jb-table-responsive">
                        <table class="jb-table jb-table-hover">
                            <thead class="jb-thead-light">
                                <tr>
                                    <th scope="col" style="width: 40px;"></th>
                                    <th scope="col">{{#str}}applicant, local_jobboard{{/str}}</th>
                                    <th scope="col">{{#str}}vacancy, local_jobboard{{/str}}</th>
                                    <th scope="col">{{#str}}status{{/str}}</th>
                                    <th scope="col">{{#str}}dateapplied, local_jobboard{{/str}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#unassigned}}
                                <tr class="jb-fade-in" style="animation-delay: calc(0.45s + {{@index}} * 0.02s);">
                                    <td>
                                        <input type="checkbox" name="applications[]" value="{{id}}" class="app-checkbox">
                                    </td>
                                    <td><strong>{{applicantname}}</strong></td>
                                    <td><code class="jb-text-primary">{{vacancycode}}</code></td>
                                    <td><span class="jb-badge jb-badge-{{statuscolor}}">{{statustext}}</span></td>
                                    <td class="jb-text-muted">{{dateapplied}}</td>
                                </tr>
                                {{/unassigned}}
                            </tbody>
                        </table>
                    </div>

                    <div class="jb-mt-3">
                        <button type="submit" class="jb-btn jb-btn-primary jb-hover-lift">
                            <i class="fa fa-user-plus jb-mr-2" aria-hidden="true"></i>
                            {{#str}}assignselected, local_jobboard{{/str}}
                        </button>
                    </div>
                </form>
                {{/hasunassigned}}
                {{^hasunassigned}}
                <div class="jb-empty-state jb-text-center jb-py-5">
                    <div class="jb-icon-circle jb-bg-success jb-text-white jb-mx-auto jb-mb-3" style="width: 80px; height: 80px;">
                        <i class="fa fa-circle-check fa-2x" aria-hidden="true"></i>
                    </div>
                    <h5 class="jb-text-success jb-mb-2">{{#str}}alldone, local_jobboard{{/str}}</h5>
                    <p class="jb-text-muted jb-mb-0">{{#str}}nounassignedapplications, local_jobboard{{/str}}</p>
                </div>
                {{/hasunassigned}}
            </div>
        </section>
    </main>

    {{! Navigation Footer }}
    <footer class="jb-card jb-card-shadow jb-mt-4 jb-bg-light jb-fade-in" style="animation-delay: 0.5s;">
        <div class="jb-card-body jb-d-flex jb-flex-wrap jb-align-items-center jb-justify-content-center jb-gap-2">
            <a href="{{dashboardurl}}" class="jb-btn jb-btn-outline-secondary jb-hover-lift">
                <i class="fa fa-gauge jb-mr-2" aria-hidden="true"></i>
                {{#str}}dashboard, local_jobboard{{/str}}
            </a>
            <a href="{{reviewurl}}" class="jb-btn jb-btn-outline-primary jb-hover-lift">
                <i class="fa fa-clipboard-check jb-mr-2" aria-hidden="true"></i>
                {{#str}}reviewapplications, local_jobboard{{/str}}
            </a>
            <a href="{{bulkvalidateurl}}" class="jb-btn jb-btn-outline-success jb-hover-lift">
                <i class="fa fa-check-double jb-mr-2" aria-hidden="true"></i>
                {{#str}}bulkvalidation, local_jobboard{{/str}}
            </a>
        </div>
    </footer>
</div>

{{! JavaScript for select all - moved outside conditional blocks for consistency }}
{{#hasunassigned}}
{{#js}}
(function() {
    var selectAll = document.getElementById('selectallapp');
    if (selectAll) {
        selectAll.addEventListener('change', function() {
            var checkboxes = document.querySelectorAll('.app-checkbox');
            var checked = this.checked;
            checkboxes.forEach(function(cb) {
                cb.checked = checked;
            });
        });
    }
})();
{{/js}}
{{/hasunassigned}}
{{/loading}}
