{{!
    @template local_jobboard/document_upload

    Document upload component template.

    Context variables required for this template:
    * applicationid - Application ID
    * documenttype - Document type code
    * documenttypename - Document type display name
    * required - Boolean if required
    * currentfile - Current file info (optional)
    * maxsize - Max file size in bytes
    * maxsizedisplay - Max file size display string
    * acceptedformats - Accepted file formats string
    * uploadurl - URL to upload to
    * issuedate - Boolean if issue date is required

    Example context (json):
    {
        "applicationid": 1,
        "documenttype": "cedula",
        "documenttypename": "National ID",
        "required": true,
        "maxsizedisplay": "5 MB",
        "acceptedformats": "PDF, JPG, PNG",
        "uploadurl": "/local/jobboard/upload.php"
    }
}}
<div class="card document-upload-card mb-3 jb-document-card"
     data-document-type="{{documenttype}}"
     data-application-id="{{applicationid}}"
     role="region"
     aria-labelledby="doc-header-{{documenttype}}">
    <div class="card-header d-flex justify-content-between align-items-center" id="doc-header-{{documenttype}}">
        <span>
            {{documenttypename}}
            {{#required}}
                <span class="badge badge-danger ml-1" aria-label="{{#str}}requireddocument, local_jobboard{{/str}}">{{#str}}required, local_jobboard{{/str}}</span>
            {{/required}}
            {{^required}}
                <span class="badge badge-secondary ml-1">{{#str}}optional, local_jobboard{{/str}}</span>
            {{/required}}
        </span>
        {{#currentfile}}
            <span class="badge badge-{{statusclass}}" role="status" aria-live="polite">
                {{#pix}}i/{{statusicon}}, core{{/pix}}
                {{statuslabel}}
            </span>
        {{/currentfile}}
    </div>
    <div class="card-body">
        {{#currentfile}}
            <div class="current-file mb-3 p-2 bg-light rounded">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        {{#pix}}f/pdf, core{{/pix}}
                        <strong>{{currentfile.filename}}</strong>
                        <small class="text-muted">({{currentfile.filesizedisplay}})</small>
                    </div>
                    <div>
                        <a href="{{currentfile.downloadurl}}" class="btn btn-sm btn-outline-primary">
                            {{#pix}}i/export, core{{/pix}}
                            {{#str}}download, local_jobboard{{/str}}
                        </a>
                        {{#canreupload}}
                            <button type="button" class="btn btn-sm btn-outline-secondary btn-reupload">
                                {{#pix}}i/reload, core{{/pix}}
                                {{#str}}resubmit, local_jobboard{{/str}}
                            </button>
                        {{/canreupload}}
                    </div>
                </div>
                {{#currentfile.rejectreason}}
                    <div class="alert alert-danger mt-2 mb-0 small">
                        <strong>{{#str}}rejectreason, local_jobboard{{/str}}:</strong>
                        {{currentfile.rejectreason}}
                    </div>
                {{/currentfile.rejectreason}}
            </div>
        {{/currentfile}}

        {{^currentfile}}
            <form class="document-upload-form jb-upload-form"
                  action="{{uploadurl}}"
                  method="post"
                  enctype="multipart/form-data"
                  aria-label="{{#str}}uploadform, local_jobboard{{/str}}: {{documenttypename}}">
                <input type="hidden" name="applicationid" value="{{applicationid}}">
                <input type="hidden" name="documenttype" value="{{documenttype}}">
                <input type="hidden" name="sesskey" value="{{sesskey}}">

                <div class="form-group">
                    <label for="file_{{documenttype}}" id="file_label_{{documenttype}}">
                        {{#str}}uploadfile, local_jobboard{{/str}}
                        {{#required}}<span class="text-danger" aria-hidden="true">*</span>{{/required}}
                    </label>
                    <div class="custom-file">
                        <input type="file"
                               class="custom-file-input"
                               id="file_{{documenttype}}"
                               name="documentfile"
                               accept="{{acceptedmimes}}"
                               {{#required}}required aria-required="true"{{/required}}
                               aria-describedby="file_help_{{documenttype}}">
                        <label class="custom-file-label" for="file_{{documenttype}}">
                            {{#str}}choosefiles, local_jobboard{{/str}}
                        </label>
                    </div>
                    <small class="form-text text-muted" id="file_help_{{documenttype}}">
                        {{#str}}allowedformats, local_jobboard{{/str}}: {{acceptedformats}}.
                        {{#str}}maxfilesize, local_jobboard{{/str}}: {{maxsizedisplay}}
                    </small>
                </div>

                {{#issuedate}}
                    <div class="form-group">
                        <label for="issuedate_{{documenttype}}">
                            {{#str}}issuedate, local_jobboard{{/str}}
                        </label>
                        <input type="date"
                               class="form-control"
                               id="issuedate_{{documenttype}}"
                               name="issuedate"
                               max="{{today}}"
                               aria-describedby="issuedate_help_{{documenttype}}">
                        <small class="form-text text-muted sr-only" id="issuedate_help_{{documenttype}}">
                            {{#str}}issuedatehelp, local_jobboard{{/str}}
                        </small>
                    </div>
                {{/issuedate}}

                <button type="submit" class="btn btn-primary btn-upload jb-btn-loading">
                    <span class="btn-text">
                        {{#pix}}i/upload, core{{/pix}}
                        {{#str}}upload, local_jobboard{{/str}}
                    </span>
                    <span class="btn-loading-indicator d-none" aria-hidden="true">
                        <i class="fa fa-spinner fa-spin mr-1"></i>
                        {{#str}}uploading, local_jobboard{{/str}}
                    </span>
                </button>
            </form>
        {{/currentfile}}

        {{#showreupload}}
            <form class="document-upload-form mt-3 d-none jb-reupload-form"
                  action="{{uploadurl}}"
                  method="post"
                  enctype="multipart/form-data">
                {{! Same form as above for re-upload }}
                <input type="hidden" name="applicationid" value="{{applicationid}}">
                <input type="hidden" name="documenttype" value="{{documenttype}}">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="supersede" value="1">

                <div class="form-group">
                    <div class="custom-file">
                        <input type="file" 
                               class="custom-file-input" 
                               name="documentfile"
                               accept="{{acceptedmimes}}"
                               required>
                        <label class="custom-file-label">
                            {{#str}}choosefiles, local_jobboard{{/str}}
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-sm">
                    {{#str}}upload, local_jobboard{{/str}}
                </button>
                <button type="button" class="btn btn-secondary btn-sm btn-cancel-reupload">
                    {{#str}}cancel, local_jobboard{{/str}}
                </button>
            </form>
        {{/showreupload}}
    </div>
</div>
