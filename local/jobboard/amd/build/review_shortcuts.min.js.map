{"version":3,"file":"review_shortcuts.min.js","sources":["../src/review_shortcuts.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Keyboard shortcuts module for document review.\n *\n * @module     local_jobboard/review_shortcuts\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/notification'],\n    function($, Str, ModalFactory, Notification) {\n    'use strict';\n\n    /**\n     * Keyboard shortcuts handler.\n     */\n    var ReviewShortcuts = {\n        /**\n         * Shortcut key mappings.\n         */\n        SHORTCUTS: {\n            'a': 'approve',\n            'r': 'reject',\n            'n': 'next',\n            'p': 'previous',\n            's': 'save',\n            '?': 'help',\n            'h': 'help'\n        },\n\n        /**\n         * Current document index.\n         */\n        currentIndex: 0,\n\n        /**\n         * Total documents.\n         */\n        totalDocuments: 0,\n\n        /**\n         * Help modal instance.\n         */\n        helpModal: null,\n\n        /**\n         * Configuration options.\n         */\n        config: {},\n\n        /**\n         * Initialize shortcuts.\n         *\n         * @param {Object} config Configuration options\n         * @param {string} config.documentSelector Selector for document items\n         * @param {string} config.approveSelector Selector for approve buttons\n         * @param {string} config.rejectSelector Selector for reject buttons\n         * @param {string} config.saveSelector Selector for save button\n         */\n        init: function(config) {\n            this.config = $.extend({\n                documentSelector: '.jb-doc-item',\n                approveSelector: '.jb-approve-btn',\n                rejectSelector: '.jb-reject-btn',\n                saveSelector: '#saveReviewBtn',\n                showHelpOnStart: true\n            }, config);\n\n            this.$documents = $(this.config.documentSelector);\n            this.totalDocuments = this.$documents.length;\n\n            if (this.totalDocuments === 0) {\n                return;\n            }\n\n            this.bindKeyboard();\n            this.showShortcutsHelp();\n            this.highlightCurrent();\n\n            if (this.config.showHelpOnStart) {\n                this.showHelpToast();\n            }\n        },\n\n        /**\n         * Bind keyboard event handlers.\n         */\n        bindKeyboard: function() {\n            var self = this;\n\n            $(document).on('keydown', function(e) {\n                // Ignore if typing in an input\n                if ($(e.target).is('input, textarea, select, [contenteditable=\"true\"]')) {\n                    return;\n                }\n\n                var key = e.key.toLowerCase();\n                var action = self.SHORTCUTS[key];\n\n                if (action) {\n                    e.preventDefault();\n                    self.handleAction(action);\n                }\n            });\n        },\n\n        /**\n         * Handle shortcut action.\n         *\n         * @param {string} action Action name\n         */\n        handleAction: function(action) {\n            switch (action) {\n                case 'approve':\n                    this.approveCurrentDocument();\n                    break;\n                case 'reject':\n                    this.rejectCurrentDocument();\n                    break;\n                case 'next':\n                    this.navigateNext();\n                    break;\n                case 'previous':\n                    this.navigatePrevious();\n                    break;\n                case 'save':\n                    this.saveReview();\n                    break;\n                case 'help':\n                    this.showHelpModal();\n                    break;\n            }\n        },\n\n        /**\n         * Approve the current document.\n         */\n        approveCurrentDocument: function() {\n            var $current = this.$documents.eq(this.currentIndex);\n            var $approveBtn = $current.find(this.config.approveSelector);\n\n            if ($approveBtn.length && !$approveBtn.prop('disabled')) {\n                $approveBtn.click();\n                this.showFeedback('approved');\n            }\n        },\n\n        /**\n         * Reject the current document.\n         */\n        rejectCurrentDocument: function() {\n            var $current = this.$documents.eq(this.currentIndex);\n            var $rejectBtn = $current.find(this.config.rejectSelector);\n\n            if ($rejectBtn.length && !$rejectBtn.prop('disabled')) {\n                $rejectBtn.click();\n            }\n        },\n\n        /**\n         * Navigate to next document.\n         */\n        navigateNext: function() {\n            if (this.currentIndex < this.totalDocuments - 1) {\n                this.currentIndex++;\n                this.highlightCurrent();\n                this.scrollToCurrent();\n            }\n        },\n\n        /**\n         * Navigate to previous document.\n         */\n        navigatePrevious: function() {\n            if (this.currentIndex > 0) {\n                this.currentIndex--;\n                this.highlightCurrent();\n                this.scrollToCurrent();\n            }\n        },\n\n        /**\n         * Save the review.\n         */\n        saveReview: function() {\n            var $saveBtn = $(this.config.saveSelector);\n            if ($saveBtn.length && !$saveBtn.prop('disabled')) {\n                $saveBtn.click();\n            }\n        },\n\n        /**\n         * Highlight the current document.\n         */\n        highlightCurrent: function() {\n            this.$documents.removeClass('active border-primary');\n            this.$documents.eq(this.currentIndex)\n                .addClass('active border-primary')\n                .attr('aria-current', 'true');\n\n            // Update aria for other items\n            this.$documents.not('.active').removeAttr('aria-current');\n        },\n\n        /**\n         * Scroll to the current document.\n         */\n        scrollToCurrent: function() {\n            var $current = this.$documents.eq(this.currentIndex);\n            if ($current.length) {\n                $('html, body').animate({\n                    scrollTop: $current.offset().top - 100\n                }, 300);\n            }\n        },\n\n        /**\n         * Show visual feedback for action.\n         *\n         * @param {string} type Feedback type\n         */\n        showFeedback: function(type) {\n            var $current = this.$documents.eq(this.currentIndex);\n            var feedbackClass = type === 'approved' ? 'bg-success' : 'bg-danger';\n\n            $current.addClass(feedbackClass + ' text-white');\n            setTimeout(function() {\n                $current.removeClass(feedbackClass + ' text-white');\n            }, 500);\n        },\n\n        /**\n         * Show shortcuts help panel.\n         */\n        showShortcutsHelp: function() {\n            var helpHtml = '<div class=\"jb-shortcuts-help\" role=\"region\" aria-label=\"Keyboard shortcuts\">';\n            helpHtml += '<strong>Atajos:</strong> ';\n            helpHtml += '<kbd>A</kbd> Aprobar ';\n            helpHtml += '<kbd>R</kbd> Rechazar ';\n            helpHtml += '<kbd>N</kbd>/<kbd>P</kbd> Navegar ';\n            helpHtml += '<kbd>S</kbd> Guardar ';\n            helpHtml += '<kbd>?</kbd> Ayuda';\n            helpHtml += '</div>';\n\n            $('body').append(helpHtml);\n        },\n\n        /**\n         * Show help toast notification.\n         */\n        showHelpToast: function() {\n            Str.get_string('keyboardshortcuts', 'local_jobboard').then(function(str) {\n                // Just log for now, could show a toast\n                window.console.log(str + ': Press ? for help');\n            }).catch(function() {\n                // Ignore\n            });\n        },\n\n        /**\n         * Show help modal with all shortcuts.\n         */\n        showHelpModal: function() {\n            var self = this;\n\n            if (this.helpModal) {\n                this.helpModal.show();\n                return;\n            }\n\n            Str.get_strings([\n                {key: 'shortcutshelp_title', component: 'local_jobboard'},\n                {key: 'shortcut_approve', component: 'local_jobboard'},\n                {key: 'shortcut_reject', component: 'local_jobboard'},\n                {key: 'shortcut_next', component: 'local_jobboard'},\n                {key: 'shortcut_previous', component: 'local_jobboard'},\n                {key: 'shortcut_save', component: 'local_jobboard'},\n                {key: 'shortcut_help', component: 'local_jobboard'}\n            ]).then(function(strings) {\n                var body = '<div class=\"jb-shortcuts-modal\">';\n                body += '<div class=\"jb-shortcut-row\"><span>' + strings[1] + '</span><kbd>A</kbd></div>';\n                body += '<div class=\"jb-shortcut-row\"><span>' + strings[2] + '</span><kbd>R</kbd></div>';\n                body += '<div class=\"jb-shortcut-row\"><span>' + strings[3] + '</span><kbd>N</kbd></div>';\n                body += '<div class=\"jb-shortcut-row\"><span>' + strings[4] + '</span><kbd>P</kbd></div>';\n                body += '<div class=\"jb-shortcut-row\"><span>' + strings[5] + '</span><kbd>S</kbd></div>';\n                body += '<div class=\"jb-shortcut-row\"><span>' + strings[6] + '</span><kbd>?</kbd> / <kbd>H</kbd></div>';\n                body += '</div>';\n\n                return ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: strings[0],\n                    body: body\n                });\n            }).then(function(modal) {\n                self.helpModal = modal;\n                modal.show();\n            }).catch(Notification.exception);\n        }\n    };\n\n    return {\n        /**\n         * Initialize review shortcuts.\n         *\n         * @param {Object} config Configuration options\n         */\n        init: function(config) {\n            ReviewShortcuts.init(config);\n        }\n    };\n});\n"],"names":["define","$","Str","ModalFactory","Notification","ReviewShortcuts","SHORTCUTS","currentIndex","totalDocuments","helpModal","config","init","extend","documentSelector","approveSelector","rejectSelector","saveSelector","showHelpOnStart","$documents","this","length","bindKeyboard","showShortcutsHelp","highlightCurrent","showHelpToast","self","document","on","e","target","is","key","toLowerCase","action","preventDefault","handleAction","approveCurrentDocument","rejectCurrentDocument","navigateNext","navigatePrevious","saveReview","showHelpModal","$approveBtn","eq","find","prop","click","showFeedback","$rejectBtn","scrollToCurrent","$saveBtn","removeClass","addClass","attr","not","removeAttr","$current","animate","scrollTop","offset","top","type","feedbackClass","setTimeout","append","helpHtml","get_string","then","str","window","console","log","catch","show","get_strings","component","strings","body","create","types","DEFAULT","title","modal","exception"],"mappings":"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"}