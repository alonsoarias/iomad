/**
 * Keyboard shortcuts module for document review.
 *
 * @module     local_jobboard/review_shortcuts
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_jobboard/review_shortcuts",["jquery","core/str","core/modal_factory","core/notification"],(function($,Str,ModalFactory,Notification){var ReviewShortcuts={SHORTCUTS:{a:"approve",r:"reject",n:"next",p:"previous",s:"save","?":"help",h:"help"},currentIndex:0,totalDocuments:0,helpModal:null,config:{},init:function(config){this.config=$.extend({documentSelector:".jb-doc-item",approveSelector:".jb-approve-btn",rejectSelector:".jb-reject-btn",saveSelector:"#saveReviewBtn",showHelpOnStart:!0},config),this.$documents=$(this.config.documentSelector),this.totalDocuments=this.$documents.length,0!==this.totalDocuments&&(this.bindKeyboard(),this.showShortcutsHelp(),this.highlightCurrent(),this.config.showHelpOnStart&&this.showHelpToast())},bindKeyboard:function(){var self=this;$(document).on("keydown",(function(e){if(!$(e.target).is('input, textarea, select, [contenteditable="true"]')){var key=e.key.toLowerCase(),action=self.SHORTCUTS[key];action&&(e.preventDefault(),self.handleAction(action))}}))},handleAction:function(action){switch(action){case"approve":this.approveCurrentDocument();break;case"reject":this.rejectCurrentDocument();break;case"next":this.navigateNext();break;case"previous":this.navigatePrevious();break;case"save":this.saveReview();break;case"help":this.showHelpModal()}},approveCurrentDocument:function(){var $approveBtn=this.$documents.eq(this.currentIndex).find(this.config.approveSelector);$approveBtn.length&&!$approveBtn.prop("disabled")&&($approveBtn.click(),this.showFeedback("approved"))},rejectCurrentDocument:function(){var $rejectBtn=this.$documents.eq(this.currentIndex).find(this.config.rejectSelector);$rejectBtn.length&&!$rejectBtn.prop("disabled")&&$rejectBtn.click()},navigateNext:function(){this.currentIndex<this.totalDocuments-1&&(this.currentIndex++,this.highlightCurrent(),this.scrollToCurrent())},navigatePrevious:function(){this.currentIndex>0&&(this.currentIndex--,this.highlightCurrent(),this.scrollToCurrent())},saveReview:function(){var $saveBtn=$(this.config.saveSelector);$saveBtn.length&&!$saveBtn.prop("disabled")&&$saveBtn.click()},highlightCurrent:function(){this.$documents.removeClass("active border-primary"),this.$documents.eq(this.currentIndex).addClass("active border-primary").attr("aria-current","true"),this.$documents.not(".active").removeAttr("aria-current")},scrollToCurrent:function(){var $current=this.$documents.eq(this.currentIndex);$current.length&&$("html, body").animate({scrollTop:$current.offset().top-100},300)},showFeedback:function(type){var $current=this.$documents.eq(this.currentIndex),feedbackClass="approved"===type?"bg-success":"bg-danger";$current.addClass(feedbackClass+" text-white"),setTimeout((function(){$current.removeClass(feedbackClass+" text-white")}),500)},showShortcutsHelp:function(){$("body").append('<div class="jb-shortcuts-help" role="region" aria-label="Keyboard shortcuts"><strong>Atajos:</strong> <kbd>A</kbd> Aprobar <kbd>R</kbd> Rechazar <kbd>N</kbd>/<kbd>P</kbd> Navegar <kbd>S</kbd> Guardar <kbd>?</kbd> Ayuda</div>')},showHelpToast:function(){Str.get_string("keyboardshortcuts","local_jobboard").then((function(str){window.console.log(str+": Press ? for help")})).catch((function(){}))},showHelpModal:function(){var self=this;this.helpModal?this.helpModal.show():Str.get_strings([{key:"shortcutshelp_title",component:"local_jobboard"},{key:"shortcut_approve",component:"local_jobboard"},{key:"shortcut_reject",component:"local_jobboard"},{key:"shortcut_next",component:"local_jobboard"},{key:"shortcut_previous",component:"local_jobboard"},{key:"shortcut_save",component:"local_jobboard"},{key:"shortcut_help",component:"local_jobboard"}]).then((function(strings){var body='<div class="jb-shortcuts-modal">';return body+='<div class="jb-shortcut-row"><span>'+strings[1]+"</span><kbd>A</kbd></div>",body+='<div class="jb-shortcut-row"><span>'+strings[2]+"</span><kbd>R</kbd></div>",body+='<div class="jb-shortcut-row"><span>'+strings[3]+"</span><kbd>N</kbd></div>",body+='<div class="jb-shortcut-row"><span>'+strings[4]+"</span><kbd>P</kbd></div>",body+='<div class="jb-shortcut-row"><span>'+strings[5]+"</span><kbd>S</kbd></div>",body+='<div class="jb-shortcut-row"><span>'+strings[6]+"</span><kbd>?</kbd> / <kbd>H</kbd></div>",body+="</div>",ModalFactory.create({type:ModalFactory.types.DEFAULT,title:strings[0],body:body})})).then((function(modal){self.helpModal=modal,modal.show()})).catch(Notification.exception)}};return{init:function(config){ReviewShortcuts.init(config)}}}));

//# sourceMappingURL=review_shortcuts.min.js.map