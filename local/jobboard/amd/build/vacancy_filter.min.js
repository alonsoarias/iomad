/**
 * Vacancy filter module with AJAX filtering.
 *
 * @module     local_jobboard/vacancy_filter
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_jobboard/vacancy_filter",["jquery","core/ajax","core/notification","core/templates","core/str"],(function($,Ajax,Notification,Templates,Str){var VacancyFilter=function(selector){this.container=$(selector),this.filterForm=this.container.find('[data-region="filter-form"]'),this.vacancyCards=this.container.find('[data-region="vacancy-cards"]'),this.debounceTimer=null,this.loadingString="Loading...",this.init()};return VacancyFilter.prototype.init=function(){var self=this;Str.get_string("loading","local_jobboard").then((function(str){self.loadingString=str})).catch((function(){})),this.registerEventListeners()},VacancyFilter.prototype.registerEventListeners=function(){var self=this;this.filterForm.on("change","select",(function(){self.applyFilters()})),this.filterForm.on("input",'input[type="text"], input[type="search"]',(function(){clearTimeout(self.debounceTimer),self.debounceTimer=setTimeout((function(){self.applyFilters()}),300)})),this.filterForm.on("click",".btn-clear-filters",(function(e){e.preventDefault(),self.clearFilters()})),this.container.on("click",".pagination a",(function(e){e.preventDefault();var page=$(this).data("page");page&&self.applyFilters(page)}))},VacancyFilter.prototype.applyFilters=function(page){var self=this,filters=this.getFilterValues();page&&(filters.page=page),this.showLoading(),Ajax.call([{methodname:"local_jobboard_filter_vacancies",args:filters}])[0].then((function(response){return self.renderResults(response)})).catch((function(error){self.hideLoading(),Notification.exception(error)}))},VacancyFilter.prototype.getFilterValues=function(){var filters={};return this.filterForm.find("input, select").each((function(){var input=$(this),name=input.attr("name"),value=input.val();name&&value&&(filters[name]=value)})),filters},VacancyFilter.prototype.clearFilters=function(){this.filterForm.find('input[type="text"], input[type="search"]').val(""),this.filterForm.find("select").prop("selectedIndex",0),this.applyFilters()},VacancyFilter.prototype.showLoading=function(){this.vacancyCards.addClass("loading"),this.vacancyCards.find(".loading-overlay").length||this.vacancyCards.append('<div class="loading-overlay"><div class="spinner-border text-primary" role="status"><span class="sr-only">'+this.loadingString+"</span></div></div>")},VacancyFilter.prototype.hideLoading=function(){this.vacancyCards.removeClass("loading"),this.vacancyCards.find(".loading-overlay").remove()},VacancyFilter.prototype.renderResults=function(response){var self=this;if(response.html)return this.vacancyCards.html(response.html),this.hideLoading(),$.Deferred().resolve().promise();if(response.vacancies&&response.vacancies.length>0){var promises=response.vacancies.map((function(vacancy){return Templates.render("local_jobboard/vacancy_card",vacancy)}));return $.when.apply($,promises).then((function(){var html=Array.prototype.slice.call(arguments).map((function(result){return'<div class="col-lg-6 col-xl-4">'+result+"</div>"})).join("");self.vacancyCards.html(html),self.hideLoading(),response.pagination&&self.container.find(".pagination").replaceWith(response.pagination)}))}return Str.get_string("noresults","local_jobboard").then((function(str){return self.vacancyCards.html('<div class="col-12"><div class="alert alert-info">'+str+"</div></div>"),self.hideLoading(),str}))},{init:function(selector){return new VacancyFilter(selector)}}}));

//# sourceMappingURL=vacancy_filter.min.js.map