/**
 * Bulk actions and confirmation modal AMD module for local_jobboard.
 *
 * Handles bulk selection, bulk actions, and confirmation modals for delete operations.
 *
 * @module     local_jobboard/bulk_actions
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_jobboard/bulk_actions",["jquery","core/notification","core/str"],(function($,Notification,Str){var JBModal_show=function(modal){if(modal){$(modal).addClass("show"),modal.style.display="block",modal.setAttribute("aria-hidden","false"),$("body").addClass("modal-open");var backdrop=$("<div>",{class:"modal-backdrop fade show",id:"jb-modal-backdrop"});$("body").append(backdrop)}},JBModal_hide=function(modal){modal&&($(modal).removeClass("show"),modal.style.display="none",modal.setAttribute("aria-hidden","true"),$("body").removeClass("modal-open"),$("#jb-modal-backdrop").remove())},pendingAction=null,updateBulkToolbar=function(element){var $form=$(element).closest("form");$form.length||($form=$(document));var $toolbar=$form.find(".jb-bulk-toolbar");if($toolbar.length){var $checkboxes=$form.find(".jb-bulk-item"),$checked=$form.find(".jb-bulk-item:checked"),count=$checked.length;$toolbar.find(".jb-selected-count").text(count),count>0?$toolbar.removeClass("d-none"):$toolbar.addClass("d-none"),$toolbar.find(".jb-bulk-action").prop("disabled",0===count);var $selectAll=$form.find(".jb-select-all");$selectAll.length&&($selectAll.prop("checked",$checkboxes.length>0&&$checkboxes.length===$checked.length),$selectAll[0].indeterminate=count>0&&count<$checkboxes.length)}},submitBulkAction=function(form,action){var $form=$(form),$actionInput=$form.find('input[name="bulkaction"]');$actionInput.length||($actionInput=$("<input>",{type:"hidden",name:"bulkaction"}),$form.append($actionInput)),$actionInput.val(action),form.submit()},showConfirmModal=function(message,onConfirm){var modal=document.getElementById("jb-confirm-modal");if(modal){var $msgEl=$(modal).find(".jb-modal-message");$msgEl.length&&$msgEl.text(message),pendingAction=onConfirm,JBModal_show(modal)}else Str.get_string("confirm").then((function(){window.confirm(message)&&onConfirm&&onConfirm()})).catch((function(){window.confirm(message)&&onConfirm&&onConfirm()}))};return{init:function(){$(document).on("change",".jb-select-all",(function(){var target=$(this).data("target"),checked=$(this).prop("checked");$(target).prop("checked",checked),updateBulkToolbar(this)})),$(document).on("change",".jb-bulk-item",(function(){updateBulkToolbar(this)})),$(document).on("click",".jb-bulk-action",(function(e){e.preventDefault();var action=$(this).data("action"),confirmMsg=$(this).data("confirm"),formId=$(this).data("form"),form=document.getElementById(formId);form&&(confirmMsg?showConfirmModal(confirmMsg,(function(){submitBulkAction(form,action)})):submitBulkAction(form,action))})),$(document).on("click",".jb-confirm-trigger",(function(e){e.preventDefault();var confirmMsg=$(this).data("confirm"),url=$(this).attr("href");confirmMsg?showConfirmModal(confirmMsg,(function(){window.location.href=url})):window.location.href=url})),$(document).on("click",".jb-modal-confirm",(function(){var modal=document.getElementById("jb-confirm-modal");JBModal_hide(modal),pendingAction&&(pendingAction(),pendingAction=null)})),$(document).on("click",'#jb-confirm-modal [data-dismiss="modal"], #jb-confirm-modal .close',(function(){var modal=document.getElementById("jb-confirm-modal");JBModal_hide(modal),pendingAction=null})),$(document).on("click","#jb-confirm-modal",(function(e){e.target===this&&(JBModal_hide(this),pendingAction=null)})),$(document).on("keydown",(function(e){if("Escape"===e.key){var modal=document.getElementById("jb-confirm-modal");modal&&$(modal).hasClass("show")&&(JBModal_hide(modal),pendingAction=null)}}))}}}));

//# sourceMappingURL=bulk_actions.min.js.map