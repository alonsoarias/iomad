{"version":3,"file":"vacancy_filter.min.js","sources":["../src/vacancy_filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Vacancy filter module with AJAX filtering.\n *\n * @module     local_jobboard/vacancy_filter\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/templates', 'core/str'],\n    function($, Ajax, Notification, Templates, Str) {\n\n    /**\n     * Vacancy Filter class.\n     *\n     * @param {string} selector Container selector\n     */\n    var VacancyFilter = function(selector) {\n        this.container = $(selector);\n        this.filterForm = this.container.find('[data-region=\"filter-form\"]');\n        this.vacancyCards = this.container.find('[data-region=\"vacancy-cards\"]');\n        this.debounceTimer = null;\n        this.loadingString = 'Loading...'; // Default fallback.\n\n        this.init();\n    };\n\n    /**\n     * Initialize the filter.\n     */\n    VacancyFilter.prototype.init = function() {\n        var self = this;\n        // Pre-load the loading string for use in spinner.\n        Str.get_string('loading', 'local_jobboard').then(function(str) {\n            self.loadingString = str;\n        }).catch(function() {\n            // Keep default fallback.\n        });\n        this.registerEventListeners();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    VacancyFilter.prototype.registerEventListeners = function() {\n        var self = this;\n\n        // Filter form changes.\n        this.filterForm.on('change', 'select', function() {\n            self.applyFilters();\n        });\n\n        // Search input with debounce.\n        this.filterForm.on('input', 'input[type=\"text\"], input[type=\"search\"]', function() {\n            clearTimeout(self.debounceTimer);\n            self.debounceTimer = setTimeout(function() {\n                self.applyFilters();\n            }, 300);\n        });\n\n        // Clear filters button.\n        this.filterForm.on('click', '.btn-clear-filters', function(e) {\n            e.preventDefault();\n            self.clearFilters();\n        });\n\n        // Pagination links.\n        this.container.on('click', '.pagination a', function(e) {\n            e.preventDefault();\n            var page = $(this).data('page');\n            if (page) {\n                self.applyFilters(page);\n            }\n        });\n    };\n\n    /**\n     * Apply current filters.\n     *\n     * @param {number} page Page number (optional)\n     */\n    VacancyFilter.prototype.applyFilters = function(page) {\n        var self = this;\n        var filters = this.getFilterValues();\n\n        if (page) {\n            filters.page = page;\n        }\n\n        this.showLoading();\n\n        Ajax.call([{\n            methodname: 'local_jobboard_filter_vacancies',\n            args: filters\n        }])[0].then(function(response) {\n            return self.renderResults(response);\n        }).catch(function(error) {\n            self.hideLoading();\n            Notification.exception(error);\n        });\n    };\n\n    /**\n     * Get current filter values.\n     *\n     * @return {object} Filter values\n     */\n    VacancyFilter.prototype.getFilterValues = function() {\n        var filters = {};\n\n        this.filterForm.find('input, select').each(function() {\n            var input = $(this);\n            var name = input.attr('name');\n            var value = input.val();\n\n            if (name && value) {\n                filters[name] = value;\n            }\n        });\n\n        return filters;\n    };\n\n    /**\n     * Clear all filters.\n     */\n    VacancyFilter.prototype.clearFilters = function() {\n        this.filterForm.find('input[type=\"text\"], input[type=\"search\"]').val('');\n        this.filterForm.find('select').prop('selectedIndex', 0);\n        this.applyFilters();\n    };\n\n    /**\n     * Show loading state.\n     */\n    VacancyFilter.prototype.showLoading = function() {\n        this.vacancyCards.addClass('loading');\n        if (!this.vacancyCards.find('.loading-overlay').length) {\n            this.vacancyCards.append(\n                '<div class=\"loading-overlay\">' +\n                '<div class=\"spinner-border text-primary\" role=\"status\">' +\n                '<span class=\"sr-only\">' + this.loadingString + '</span>' +\n                '</div></div>'\n            );\n        }\n    };\n\n    /**\n     * Hide loading state.\n     */\n    VacancyFilter.prototype.hideLoading = function() {\n        this.vacancyCards.removeClass('loading');\n        this.vacancyCards.find('.loading-overlay').remove();\n    };\n\n    /**\n     * Render filter results.\n     *\n     * @param {object} response Server response\n     * @return {Promise}\n     */\n    VacancyFilter.prototype.renderResults = function(response) {\n        var self = this;\n\n        if (response.html) {\n            this.vacancyCards.html(response.html);\n            this.hideLoading();\n            return $.Deferred().resolve().promise();\n        }\n\n        if (response.vacancies && response.vacancies.length > 0) {\n            var promises = response.vacancies.map(function(vacancy) {\n                return Templates.render('local_jobboard/vacancy_card', vacancy);\n            });\n\n            return $.when.apply($, promises).then(function() {\n                var html = Array.prototype.slice.call(arguments).map(function(result) {\n                    return '<div class=\"col-lg-6 col-xl-4\">' + result + '</div>';\n                }).join('');\n\n                self.vacancyCards.html(html);\n                self.hideLoading();\n\n                // Update pagination if provided.\n                if (response.pagination) {\n                    self.container.find('.pagination').replaceWith(response.pagination);\n                }\n            });\n        } else {\n            return Str.get_string('noresults', 'local_jobboard').then(function(str) {\n                self.vacancyCards.html(\n                    '<div class=\"col-12\"><div class=\"alert alert-info\">' + str + '</div></div>'\n                );\n                self.hideLoading();\n                return str;\n            });\n        }\n    };\n\n    return {\n        /**\n         * Initialize vacancy filter.\n         *\n         * @param {string} selector Container selector\n         */\n        init: function(selector) {\n            return new VacancyFilter(selector);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Templates","Str","VacancyFilter","selector","container","filterForm","this","find","vacancyCards","debounceTimer","loadingString","init","prototype","self","get_string","then","str","catch","registerEventListeners","on","applyFilters","clearTimeout","setTimeout","e","preventDefault","clearFilters","page","data","filters","getFilterValues","showLoading","call","methodname","args","response","renderResults","error","hideLoading","exception","each","input","name","attr","value","val","prop","addClass","length","append","removeClass","remove","html","Deferred","resolve","promise","vacancies","promises","map","vacancy","render","when","apply","Array","slice","arguments","result","join","pagination","replaceWith"],"mappings":";;;;;;;AAuBAA,uCAAO,CAAC,SAAU,YAAa,oBAAqB,iBAAkB,aAClE,SAASC,EAAGC,KAAMC,aAAcC,UAAWC,SAOvCC,cAAgB,SAASC,eACpBC,UAAYP,EAAEM,eACdE,WAAaC,KAAKF,UAAUG,KAAK,oCACjCC,aAAeF,KAAKF,UAAUG,KAAK,sCACnCE,cAAgB,UAChBC,cAAgB,kBAEhBC,eAMTT,cAAcU,UAAUD,KAAO,eACvBE,KAAOP,KAEXL,IAAIa,WAAW,UAAW,kBAAkBC,MAAK,SAASC,KACtDH,KAAKH,cAAgBM,OACtBC,OAAM,oBAGJC,0BAMThB,cAAcU,UAAUM,uBAAyB,eACzCL,KAAOP,UAGND,WAAWc,GAAG,SAAU,UAAU,WACnCN,KAAKO,uBAIJf,WAAWc,GAAG,QAAS,4CAA4C,WACpEE,aAAaR,KAAKJ,eAClBI,KAAKJ,cAAgBa,YAAW,WAC5BT,KAAKO,iBACN,aAIFf,WAAWc,GAAG,QAAS,sBAAsB,SAASI,GACvDA,EAAEC,iBACFX,KAAKY,uBAIJrB,UAAUe,GAAG,QAAS,iBAAiB,SAASI,GACjDA,EAAEC,qBACEE,KAAO7B,EAAES,MAAMqB,KAAK,QACpBD,MACAb,KAAKO,aAAaM,UAU9BxB,cAAcU,UAAUQ,aAAe,SAASM,UACxCb,KAAOP,KACPsB,QAAUtB,KAAKuB,kBAEfH,OACAE,QAAQF,KAAOA,WAGdI,cAELhC,KAAKiC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAML,WACN,GAAGb,MAAK,SAASmB,iBACVrB,KAAKsB,cAAcD,aAC3BjB,OAAM,SAASmB,OACdvB,KAAKwB,cACLtC,aAAauC,UAAUF,WAS/BlC,cAAcU,UAAUiB,gBAAkB,eAClCD,QAAU,eAETvB,WAAWE,KAAK,iBAAiBgC,MAAK,eACnCC,MAAQ3C,EAAES,MACVmC,KAAOD,MAAME,KAAK,QAClBC,MAAQH,MAAMI,MAEdH,MAAQE,QACRf,QAAQa,MAAQE,UAIjBf,SAMX1B,cAAcU,UAAUa,aAAe,gBAC9BpB,WAAWE,KAAK,4CAA4CqC,IAAI,SAChEvC,WAAWE,KAAK,UAAUsC,KAAK,gBAAiB,QAChDzB,gBAMTlB,cAAcU,UAAUkB,YAAc,gBAC7BtB,aAAasC,SAAS,WACtBxC,KAAKE,aAAaD,KAAK,oBAAoBwC,aACvCvC,aAAawC,OACd,6GAE2B1C,KAAKI,cAFhC,wBAWZR,cAAcU,UAAUyB,YAAc,gBAC7B7B,aAAayC,YAAY,gBACzBzC,aAAaD,KAAK,oBAAoB2C,UAS/ChD,cAAcU,UAAUuB,cAAgB,SAASD,cACzCrB,KAAOP,QAEP4B,SAASiB,iBACJ3C,aAAa2C,KAAKjB,SAASiB,WAC3Bd,cACExC,EAAEuD,WAAWC,UAAUC,aAG9BpB,SAASqB,WAAarB,SAASqB,UAAUR,OAAS,EAAG,KACjDS,SAAWtB,SAASqB,UAAUE,KAAI,SAASC,gBACpC1D,UAAU2D,OAAO,8BAA+BD,mBAGpD7D,EAAE+D,KAAKC,MAAMhE,EAAG2D,UAAUzC,MAAK,eAC9BoC,KAAOW,MAAMlD,UAAUmD,MAAMhC,KAAKiC,WAAWP,KAAI,SAASQ,cACnD,kCAAoCA,OAAS,YACrDC,KAAK,IAERrD,KAAKL,aAAa2C,KAAKA,MACvBtC,KAAKwB,cAGDH,SAASiC,YACTtD,KAAKT,UAAUG,KAAK,eAAe6D,YAAYlC,SAASiC,sBAIzDlE,IAAIa,WAAW,YAAa,kBAAkBC,MAAK,SAASC,YAC/DH,KAAKL,aAAa2C,KACd,qDAAuDnC,IAAM,gBAEjEH,KAAKwB,cACErB,QAKZ,CAMHL,KAAM,SAASR,iBACJ,IAAID,cAAcC"}