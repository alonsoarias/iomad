/**
 * AMD module for dynamic department loading based on company selection.
 *
 * @module     local_jobboard/department_loader
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/str"],(function($,Str){"use strict";var loadDepartments=function(departmentSelect,companyId,preselect,allLabel){departmentSelect.empty();var placeholderKey=allLabel?null:"selectdepartment";var placeholderText=allLabel||"Seleccionar modalidad...";if(!companyId||companyId==="0"||companyId===0){if(placeholderKey){Str.get_string(placeholderKey,"local_jobboard").done(function(str){departmentSelect.append($("<option>",{value:0,text:str}))}).fail(function(){departmentSelect.append($("<option>",{value:0,text:placeholderText}))})}else{departmentSelect.append($("<option>",{value:0,text:placeholderText}))}return}departmentSelect.prop("disabled",true);Str.get_string("loading","local_jobboard").done(function(str){departmentSelect.append($("<option>",{value:0,text:str+"..."}))}).fail(function(){departmentSelect.append($("<option>",{value:0,text:"Cargando..."}))});$.ajax({url:M.cfg.wwwroot+"/local/jobboard/ajax/get_departments.php",method:"GET",data:{companyid:parseInt(companyId,10)},dataType:"json"}).done(function(response){departmentSelect.empty();departmentSelect.prop("disabled",false);var defaultPlaceholder=allLabel||"Seleccionar modalidad...";var placeholderOption=$("<option>",{value:0,text:defaultPlaceholder});departmentSelect.append(placeholderOption);if(response.success&&response.departments&&response.departments.length>0){$.each(response.departments,function(index,dept){var option=$("<option>",{value:dept.id,text:dept.name});if(preselect&&parseInt(preselect,10)===parseInt(dept.id,10)){option.prop("selected",true)}departmentSelect.append(option)})}if(!allLabel){Str.get_string("selectdepartment","local_jobboard").done(function(str){placeholderOption.text(str)})}}).fail(function(jqXHR,textStatus,errorThrown){departmentSelect.empty();departmentSelect.prop("disabled",false);if(allLabel){departmentSelect.append($("<option>",{value:0,text:allLabel}))}else{Str.get_string("selectdepartment","local_jobboard").done(function(str){departmentSelect.append($("<option>",{value:0,text:str}))}).fail(function(){departmentSelect.append($("<option>",{value:0,text:placeholderText}))})}console.error("Error loading departments:",textStatus,errorThrown)})};var findElement=function(baseName,context){var selectors=['select[name="'+baseName+'"]',"#id_"+baseName,"#id_"+baseName+"_signup",'[id$="_'+baseName+'"]'];var $context=context?$(context):$(document);for(var i=0;i<selectors.length;i++){var $el=$context.find(selectors[i]);if($el.length){return $el.first()}}for(var j=0;j<selectors.length;j++){var $elem=$(selectors[j]);if($elem.length){return $elem.first()}}return $()};var init=function(options){options=options||{};var companySelect,departmentSelect;if(options.companySelector){companySelect=$(options.companySelector)}else{companySelect=findElement("companyid",options.formContext)}if(options.departmentSelector){departmentSelect=$(options.departmentSelector)}else{departmentSelect=findElement("departmentid",options.formContext)}if(!companySelect.length||!departmentSelect.length){console.log("JobBoard department_loader: Company or department selects not found");return}console.log("JobBoard department_loader: Initialized with",companySelect.attr("id")||companySelect.attr("name"),departmentSelect.attr("id")||departmentSelect.attr("name"));companySelect.on("change",function(){var companyId=$(this).val();loadDepartments(departmentSelect,companyId)});var initialCompany=companySelect.val();if(initialCompany&&initialCompany!=="0"&&initialCompany!==0){loadDepartments(departmentSelect,initialCompany,options.preselect)}};return{init:init,loadDepartments:loadDepartments,findElement:findElement}}));
//# sourceMappingURL=department_loader.min.js.map