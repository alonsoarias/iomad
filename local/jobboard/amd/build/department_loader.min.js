/**
 * AMD module for dynamic department loading based on company selection.
 *
 * This unified module can be used across all forms that have company/department selectors.
 * It uses the AJAX endpoint which works for both authenticated and guest users.
 *
 * @module     local_jobboard/department_loader
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_jobboard/department_loader",["jquery","core/str"],(function($,Str){var loadDepartments=function(departmentSelect,companyId,preselect,allLabel){departmentSelect.empty();var placeholderKey=allLabel?null:"selectdepartment",placeholderText=allLabel||"Seleccionar modalidad...";companyId&&"0"!==companyId&&0!==companyId?(departmentSelect.prop("disabled",!0),Str.get_string("loading","local_jobboard").done((function(str){departmentSelect.append($("<option>",{value:0,text:str+"..."}))})).fail((function(){departmentSelect.append($("<option>",{value:0,text:"Cargando..."}))})),$.ajax({url:M.cfg.wwwroot+"/local/jobboard/ajax/get_departments.php",method:"GET",data:{companyid:parseInt(companyId,10)},dataType:"json"}).done((function(response){departmentSelect.empty(),departmentSelect.prop("disabled",!1);var placeholderOption=$("<option>",{value:0,text:allLabel||"Seleccionar modalidad..."});departmentSelect.append(placeholderOption),response.success&&response.departments&&response.departments.length>0&&$.each(response.departments,(function(index,dept){var option=$("<option>",{value:dept.id,text:dept.name});preselect&&parseInt(preselect,10)===parseInt(dept.id,10)&&option.prop("selected",!0),departmentSelect.append(option)})),allLabel||Str.get_string("selectdepartment","local_jobboard").done((function(str){placeholderOption.text(str)}))})).fail((function(jqXHR,textStatus,errorThrown){departmentSelect.empty(),departmentSelect.prop("disabled",!1),allLabel?departmentSelect.append($("<option>",{value:0,text:allLabel})):Str.get_string("selectdepartment","local_jobboard").done((function(str){departmentSelect.append($("<option>",{value:0,text:str}))})).fail((function(){departmentSelect.append($("<option>",{value:0,text:placeholderText}))})),console.error("Error loading departments:",textStatus,errorThrown)}))):placeholderKey?Str.get_string(placeholderKey,"local_jobboard").done((function(str){departmentSelect.append($("<option>",{value:0,text:str}))})).fail((function(){departmentSelect.append($("<option>",{value:0,text:placeholderText}))})):departmentSelect.append($("<option>",{value:0,text:placeholderText}))},findElement=function(baseName,context){for(var selectors=['select[name="'+baseName+'"]',"#id_"+baseName,"#id_"+baseName+"_signup",'[id$="_'+baseName+'"]'],$context=$(context||document),i=0;i<selectors.length;i++){var $el=$context.find(selectors[i]);if($el.length)return $el.first()}for(var j=0;j<selectors.length;j++){var $elem=$(selectors[j]);if($elem.length)return $elem.first()}return $()};return{init:function(options){var companySelect,departmentSelect;if(companySelect=(options=options||{}).companySelector?$(options.companySelector):findElement("companyid",options.formContext),departmentSelect=options.departmentSelector?$(options.departmentSelector):findElement("departmentid",options.formContext),companySelect.length&&departmentSelect.length){console.log("JobBoard department_loader: Initialized with",companySelect.attr("id")||companySelect.attr("name"),departmentSelect.attr("id")||departmentSelect.attr("name")),companySelect.on("change",(function(){var companyId=$(this).val();loadDepartments(departmentSelect,companyId)}));var initialCompany=companySelect.val();initialCompany&&"0"!==initialCompany&&0!==initialCompany&&loadDepartments(departmentSelect,initialCompany,options.preselect)}else console.log("JobBoard department_loader: Company or department selects not found")},loadDepartments:loadDepartments,findElement:findElement}}));

//# sourceMappingURL=department_loader.min.js.map