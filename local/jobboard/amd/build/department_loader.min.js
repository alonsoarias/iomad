/**
 * AMD module for dynamic department loading based on company selection.
 *
 * This unified module can be used across all forms that have company/department selectors.
 * It uses the AJAX endpoint which works for both authenticated and guest users.
 *
 * @module     local_jobboard/department_loader
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/str"],(function(e,t){"use strict";var n=function(n,o,a,r){n.empty();var d=r?null:"selectdepartment",i=r||"Seleccionar modalidad...";o&&"0"!==o&&0!==o?(n.prop("disabled",!0),t.get_string("loading","local_jobboard").done((function(t){n.append(e("<option>",{value:0,text:t+"..."}))})).fail((function(){n.append(e("<option>",{value:0,text:"Cargando..."}))})),e.ajax({url:M.cfg.wwwroot+"/local/jobboard/ajax/get_departments.php",method:"GET",data:{companyid:parseInt(o,10)},dataType:"json"}).done((function(o){n.empty(),n.prop("disabled",!1);var d=function(t){n.append(e("<option>",{value:0,text:t})),o.success&&o.departments&&o.departments.length>0&&e.each(o.departments,(function(t,o){var r=e("<option>",{value:o.id,text:o.name});a&&parseInt(a,10)===parseInt(o.id,10)&&r.prop("selected",!0),n.append(r)}))};r?d(r):t.get_string("selectdepartment","local_jobboard").done((function(e){d(e)})).fail((function(){d(i)}))})).fail((function(o,a,d){n.empty(),n.prop("disabled",!1),r?n.append(e("<option>",{value:0,text:r})):t.get_string("selectdepartment","local_jobboard").done((function(t){n.append(e("<option>",{value:0,text:t}))})).fail((function(){n.append(e("<option>",{value:0,text:i}))})),console.error("Error loading departments:",a,d)}))):d?t.get_string(d,"local_jobboard").done((function(t){n.append(e("<option>",{value:0,text:t}))})).fail((function(){n.append(e("<option>",{value:0,text:i}))})):n.append(e("<option>",{value:0,text:i}))},o=function(t,n){for(var o=['select[name="'+t+'"]',"#id_"+t,"#id_"+t+"_signup",'[id$="_'+t+'"]'],a=e(n||document),r=0;r<o.length;r++){var d=a.find(o[r]);if(d.length)return d.first()}for(var i=0;i<o.length;i++){var p=e(o[i]);if(p.length)return p.first()}return e()};return{init:function(t){var a,r;if(a=(t=t||{}).companySelector?e(t.companySelector):o("companyid",t.formContext),r=t.departmentSelector?e(t.departmentSelector):o("departmentid",t.formContext),a.length&&r.length){console.log("JobBoard department_loader: Initialized with",a.attr("id")||a.attr("name"),r.attr("id")||r.attr("name")),a.on("change",(function(){var t=e(this).val();n(r,t)}));var d=a.val();d&&"0"!==d&&0!==d&&n(r,d,t.preselect)}else console.log("JobBoard department_loader: Company or department selects not found")},loadDepartments:n,findElement:o}}));
//# sourceMappingURL=department_loader.min.js.map