{"version":3,"file":"signup_form.min.js","sources":["../src/signup_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for signup form with dynamic department loading.\n *\n * @module     local_jobboard/signup_form\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    /**\n     * Initialize the signup form handlers.\n     */\n    var init = function() {\n        var companySelect = $('#id_companyid_signup');\n        var departmentSelect = $('#id_departmentid_signup');\n\n        // Exit if elements don't exist (not an IOMAD installation).\n        if (!companySelect.length || !departmentSelect.length) {\n            return;\n        }\n\n        /**\n         * Load departments for the selected company.\n         *\n         * @param {number} companyId The selected company ID.\n         */\n        var loadDepartments = function(companyId) {\n            // Clear current options.\n            departmentSelect.empty();\n\n            if (!companyId || companyId === '0') {\n                // No company selected, add placeholder.\n                Str.get_string('selectdepartment', 'local_jobboard').done(function(str) {\n                    departmentSelect.append($('<option>', {\n                        value: 0,\n                        text: str\n                    }));\n                });\n                return;\n            }\n\n            // Show loading state.\n            departmentSelect.prop('disabled', true);\n            Str.get_string('loading', 'local_jobboard').done(function(str) {\n                departmentSelect.append($('<option>', {\n                    value: 0,\n                    text: str + '...'\n                }));\n            });\n\n            // Fetch departments via AJAX endpoint.\n            $.ajax({\n                url: M.cfg.wwwroot + '/local/jobboard/ajax/get_departments.php',\n                method: 'GET',\n                data: {\n                    companyid: parseInt(companyId, 10)\n                },\n                dataType: 'json'\n            }).done(function(response) {\n                departmentSelect.empty();\n                departmentSelect.prop('disabled', false);\n\n                // Add placeholder option.\n                Str.get_string('selectdepartment', 'local_jobboard').done(function(str) {\n                    departmentSelect.append($('<option>', {\n                        value: 0,\n                        text: str\n                    }));\n\n                    // Add department options.\n                    if (response.success && response.departments && response.departments.length > 0) {\n                        $.each(response.departments, function(index, dept) {\n                            departmentSelect.append($('<option>', {\n                                value: dept.id,\n                                text: dept.name\n                            }));\n                        });\n                    }\n                }).fail(function() {\n                    // Fallback if string not found.\n                    departmentSelect.append($('<option>', {\n                        value: 0,\n                        text: 'Select department...'\n                    }));\n\n                    if (response.success && response.departments && response.departments.length > 0) {\n                        $.each(response.departments, function(index, dept) {\n                            departmentSelect.append($('<option>', {\n                                value: dept.id,\n                                text: dept.name\n                            }));\n                        });\n                    }\n                });\n\n            }).fail(function(jqXHR, textStatus, errorThrown) {\n                departmentSelect.empty();\n                departmentSelect.prop('disabled', false);\n                Str.get_string('selectdepartment', 'local_jobboard').done(function(str) {\n                    departmentSelect.append($('<option>', {\n                        value: 0,\n                        text: str\n                    }));\n                }).fail(function() {\n                    departmentSelect.append($('<option>', {\n                        value: 0,\n                        text: 'Select department...'\n                    }));\n                });\n                // eslint-disable-next-line no-console\n                console.error('Error loading departments:', textStatus, errorThrown);\n            });\n        };\n\n        // Handle company change.\n        companySelect.on('change', function() {\n            var companyId = $(this).val();\n            loadDepartments(companyId);\n        });\n\n        // Load departments if company is pre-selected.\n        var initialCompany = companySelect.val();\n        if (initialCompany && initialCompany !== '0') {\n            loadDepartments(initialCompany);\n        }\n\n        // Add password strength indicator.\n        var passwordField = $('#id_password');\n        if (passwordField.length) {\n            var strengthIndicator = $('<div>', {\n                'class': 'password-strength mt-1',\n                'id': 'password-strength'\n            });\n            passwordField.after(strengthIndicator);\n\n            passwordField.on('keyup', function() {\n                var password = $(this).val();\n                var strength = checkPasswordStrength(password);\n                updateStrengthIndicator(strength);\n            });\n        }\n\n        /**\n         * Check password strength.\n         *\n         * @param {string} password The password to check.\n         * @return {Object} Strength details.\n         */\n        var checkPasswordStrength = function(password) {\n            var strength = {\n                score: 0,\n                level: 'weak'\n            };\n\n            if (!password) {\n                return strength;\n            }\n\n            // Length check.\n            if (password.length >= 8) {\n                strength.score += 1;\n            }\n            if (password.length >= 12) {\n                strength.score += 1;\n            }\n\n            // Character variety checks.\n            if (/[a-z]/.test(password)) {\n                strength.score += 1;\n            }\n            if (/[A-Z]/.test(password)) {\n                strength.score += 1;\n            }\n            if (/[0-9]/.test(password)) {\n                strength.score += 1;\n            }\n            if (/[^a-zA-Z0-9]/.test(password)) {\n                strength.score += 1;\n            }\n\n            // Determine level.\n            if (strength.score >= 5) {\n                strength.level = 'strong';\n            } else if (strength.score >= 3) {\n                strength.level = 'medium';\n            } else {\n                strength.level = 'weak';\n            }\n\n            return strength;\n        };\n\n        /**\n         * Update the strength indicator display.\n         *\n         * @param {Object} strength The strength object.\n         */\n        var updateStrengthIndicator = function(strength) {\n            var indicator = $('#password-strength');\n            var colors = {\n                'weak': 'danger',\n                'medium': 'warning',\n                'strong': 'success'\n            };\n\n            Str.get_string('password_strength_' + strength.level, 'local_jobboard').done(function(str) {\n                indicator.html(\n                    '<small class=\"text-' + colors[strength.level] + '\">' +\n                    '<i class=\"fa fa-shield me-1\"></i>' + str +\n                    '</small>'\n                );\n            }).fail(function() {\n                // Fallback if string not found.\n                indicator.html(\n                    '<small class=\"text-' + colors[strength.level] + '\">' +\n                    '<i class=\"fa fa-shield me-1\"></i>' + strength.level +\n                    '</small>'\n                );\n            });\n        };\n\n        // Email validation on blur.\n        var emailField = $('#id_email');\n        var email2Field = $('#id_email2');\n\n        if (emailField.length && email2Field.length) {\n            email2Field.on('blur', function() {\n                var email1 = emailField.val();\n                var email2 = $(this).val();\n\n                if (email1 && email2 && email1 !== email2) {\n                    $(this).addClass('is-invalid');\n                    Str.get_string('emailnotmatch', 'local_jobboard').done(function(str) {\n                        if (!$(this).siblings('.invalid-feedback').length) {\n                            $(this).after('<div class=\"invalid-feedback\">' + str + '</div>');\n                        }\n                    }.bind(this));\n                } else {\n                    $(this).removeClass('is-invalid');\n                    $(this).siblings('.invalid-feedback').remove();\n                }\n            });\n        }\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","init","companySelect","departmentSelect","length","loadDepartments","companyId","empty","prop","get_string","done","str","append","value","text","ajax","url","M","cfg","wwwroot","method","data","companyid","parseInt","dataType","response","success","departments","each","index","dept","id","name","fail","jqXHR","textStatus","errorThrown","console","error","on","this","val","initialCompany","passwordField","strengthIndicator","after","password","strength","checkPasswordStrength","updateStrengthIndicator","score","level","test","indicator","colors","html","emailField","email2Field","email1","email2","addClass","siblings","bind","removeClass","remove"],"mappings":"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"}