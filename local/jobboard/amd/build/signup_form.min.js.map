{"version":3,"file":"signup_form.min.js","sources":["../src/signup_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for signup form with dynamic company and department loading.\n *\n * @module     local_jobboard/signup_form\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/str',\n    'local_jobboard/department_loader',\n    'local_jobboard/company_loader'\n], function($, Str, DepartmentLoader, CompanyLoader) {\n    'use strict';\n\n    /**\n     * Initialize the signup form handlers.\n     *\n     * @param {Object} options Configuration options.\n     * @param {number} options.preselect Optional department ID to preselect.\n     * @param {number} options.companyPreselect Optional company ID to preselect.\n     * @param {boolean} options.loadCompaniesAjax Whether to load companies via AJAX.\n     */\n    var init = function(options) {\n        options = options || {};\n\n        var companySelect = $('#id_companyid_signup');\n\n        // Initialize company/department loaders based on available elements.\n        if (companySelect.length && options.loadCompaniesAjax) {\n            // Use company loader for AJAX loading of companies and departments.\n            CompanyLoader.init({\n                companySelector: '#id_companyid_signup',\n                departmentSelector: '#id_departmentid_signup',\n                preselect: options.companyPreselect,\n                departmentPreselect: options.preselect\n            });\n        } else if (companySelect.length) {\n            // Fall back to department loader only (companies already loaded server-side).\n            DepartmentLoader.init({\n                companySelector: '#id_companyid_signup, select[name=\"companyid\"]',\n                departmentSelector: '#id_departmentid_signup, select[name=\"departmentid\"]',\n                preselect: options.preselect\n            });\n        }\n\n        // Add password strength indicator.\n        var passwordField = $('#id_password');\n        if (passwordField.length) {\n            var strengthIndicator = $('<div>', {\n                'class': 'password-strength mt-1',\n                'id': 'password-strength'\n            });\n            passwordField.after(strengthIndicator);\n\n            passwordField.on('keyup', function() {\n                var password = $(this).val();\n                var strength = checkPasswordStrength(password);\n                updateStrengthIndicator(strength);\n            });\n        }\n\n        /**\n         * Check password strength.\n         *\n         * @param {string} password The password to check.\n         * @return {Object} Strength details.\n         */\n        var checkPasswordStrength = function(password) {\n            var strength = {\n                score: 0,\n                level: 'weak'\n            };\n\n            if (!password) {\n                return strength;\n            }\n\n            // Length check.\n            if (password.length >= 8) {\n                strength.score += 1;\n            }\n            if (password.length >= 12) {\n                strength.score += 1;\n            }\n\n            // Character variety checks.\n            if (/[a-z]/.test(password)) {\n                strength.score += 1;\n            }\n            if (/[A-Z]/.test(password)) {\n                strength.score += 1;\n            }\n            if (/[0-9]/.test(password)) {\n                strength.score += 1;\n            }\n            if (/[^a-zA-Z0-9]/.test(password)) {\n                strength.score += 1;\n            }\n\n            // Determine level.\n            if (strength.score >= 5) {\n                strength.level = 'strong';\n            } else if (strength.score >= 3) {\n                strength.level = 'medium';\n            } else {\n                strength.level = 'weak';\n            }\n\n            return strength;\n        };\n\n        /**\n         * Update the strength indicator display.\n         *\n         * @param {Object} strength The strength object.\n         */\n        var updateStrengthIndicator = function(strength) {\n            var indicator = $('#password-strength');\n            var colors = {\n                'weak': 'danger',\n                'medium': 'warning',\n                'strong': 'success'\n            };\n\n            Str.get_string('password_strength_' + strength.level, 'local_jobboard').done(function(str) {\n                indicator.html(\n                    '<small class=\"text-' + colors[strength.level] + '\">' +\n                    '<i class=\"fa fa-shield me-1\"></i>' + str +\n                    '</small>'\n                );\n            }).fail(function() {\n                // Fallback if string not found.\n                indicator.html(\n                    '<small class=\"text-' + colors[strength.level] + '\">' +\n                    '<i class=\"fa fa-shield me-1\"></i>' + strength.level +\n                    '</small>'\n                );\n            });\n        };\n\n        // Email validation on blur.\n        var emailField = $('#id_email');\n        var email2Field = $('#id_email2');\n\n        if (emailField.length && email2Field.length) {\n            email2Field.on('blur', function() {\n                var email1 = emailField.val();\n                var email2 = $(this).val();\n\n                if (email1 && email2 && email1 !== email2) {\n                    $(this).addClass('is-invalid');\n                    Str.get_string('emailnotmatch', 'local_jobboard').done(function(str) {\n                        if (!$(this).siblings('.invalid-feedback').length) {\n                            $(this).after('<div class=\"invalid-feedback\">' + str + '</div>');\n                        }\n                    }.bind(this));\n                } else {\n                    $(this).removeClass('is-invalid');\n                    $(this).siblings('.invalid-feedback').remove();\n                }\n            });\n        }\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Str","DepartmentLoader","CompanyLoader","init","options","companySelect","length","loadCompaniesAjax","companySelector","departmentSelector","preselect","companyPreselect","departmentPreselect","passwordField","strengthIndicator","after","on","password","this","val","strength","checkPasswordStrength","updateStrengthIndicator","score","level","test","indicator","colors","get_string","done","str","html","fail","emailField","email2Field","email1","email2","addClass","siblings","bind","removeClass","remove"],"mappings":";;;;;;;AAsBAA,oCAAO,CACH,SACA,WACA,mCACA,kCACD,SAASC,EAAGC,IAAKC,iBAAkBC,qBAyJ3B,CACHC,KA/IO,SAASC,SAChBA,QAAUA,SAAW,OAEjBC,cAAgBN,EAAE,wBAGlBM,cAAcC,QAAUF,QAAQG,kBAEhCL,cAAcC,KAAK,CACfK,gBAAiB,uBACjBC,mBAAoB,0BACpBC,UAAWN,QAAQO,iBACnBC,oBAAqBR,QAAQM,YAE1BL,cAAcC,QAErBL,iBAAiBE,KAAK,CAClBK,gBAAiB,iDACjBC,mBAAoB,uDACpBC,UAAWN,QAAQM,gBAKvBG,cAAgBd,EAAE,mBAClBc,cAAcP,OAAQ,KAClBQ,kBAAoBf,EAAE,QAAS,OACtB,4BACH,sBAEVc,cAAcE,MAAMD,mBAEpBD,cAAcG,GAAG,SAAS,eAClBC,SAAWlB,EAAEmB,MAAMC,MACnBC,SAAWC,sBAAsBJ,UACrCK,wBAAwBF,iBAU5BC,sBAAwB,SAASJ,cAC7BG,SAAW,CACXG,MAAO,EACPC,MAAO,eAGNP,UAKDA,SAASX,QAAU,IACnBc,SAASG,OAAS,GAElBN,SAASX,QAAU,KACnBc,SAASG,OAAS,GAIlB,QAAQE,KAAKR,YACbG,SAASG,OAAS,GAElB,QAAQE,KAAKR,YACbG,SAASG,OAAS,GAElB,QAAQE,KAAKR,YACbG,SAASG,OAAS,GAElB,eAAeE,KAAKR,YACpBG,SAASG,OAAS,GAIlBH,SAASG,OAAS,EAClBH,SAASI,MAAQ,SACVJ,SAASG,OAAS,EACzBH,SAASI,MAAQ,SAEjBJ,SAASI,MAAQ,OAGdJ,UAlCIA,UA0CXE,wBAA0B,SAASF,cAC/BM,UAAY3B,EAAE,sBACd4B,OAAS,MACD,gBACE,iBACA,WAGd3B,IAAI4B,WAAW,qBAAuBR,SAASI,MAAO,kBAAkBK,MAAK,SAASC,KAClFJ,UAAUK,KACN,sBAAwBJ,OAAOP,SAASI,OAAxC,sCACsCM,IACtC,eAELE,MAAK,WAEJN,UAAUK,KACN,sBAAwBJ,OAAOP,SAASI,OAAxC,sCACsCJ,SAASI,MAC/C,gBAMRS,WAAalC,EAAE,aACfmC,YAAcnC,EAAE,cAEhBkC,WAAW3B,QAAU4B,YAAY5B,QACjC4B,YAAYlB,GAAG,QAAQ,eACfmB,OAASF,WAAWd,MACpBiB,OAASrC,EAAEmB,MAAMC,MAEjBgB,QAAUC,QAAUD,SAAWC,QAC/BrC,EAAEmB,MAAMmB,SAAS,cACjBrC,IAAI4B,WAAW,gBAAiB,kBAAkBC,KAAK,SAASC,KACvD/B,EAAEmB,MAAMoB,SAAS,qBAAqBhC,QACvCP,EAAEmB,MAAMH,MAAM,iCAAmCe,IAAM,WAE7DS,KAAKrB,SAEPnB,EAAEmB,MAAMsB,YAAY,cACpBzC,EAAEmB,MAAMoB,SAAS,qBAAqBG"}