{"version":3,"file":"application_confirm.min.js","sources":["../src/application_confirm.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Application confirmation modal module.\n *\n * Handles the confirmation dialog before submitting a job application.\n *\n * @module     local_jobboard/application_confirm\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/str', 'core/notification'],\n    function($, ModalFactory, ModalEvents, Str, Notification) {\n    'use strict';\n\n    var ApplicationConfirm = {\n        modal: null,\n        form: null,\n        submitButton: null,\n\n        /**\n         * Initialize the confirmation module.\n         *\n         * @param {Object} config Configuration options\n         * @param {string} config.formSelector Form selector\n         * @param {number} config.totalDocs Total required documents\n         * @param {number} config.uploadedDocs Number of uploaded documents\n         */\n        init: function(config) {\n            this.config = $.extend({\n                formSelector: 'form.mform',\n                totalDocs: 0,\n                uploadedDocs: 0\n            }, config);\n\n            this.form = $(this.config.formSelector);\n            this.submitButton = this.form.find('input[type=\"submit\"][name=\"submitbutton\"]');\n\n            if (!this.form.length || !this.submitButton.length) {\n                return;\n            }\n\n            this.createModal();\n            this.bindEvents();\n        },\n\n        /**\n         * Create the confirmation modal.\n         */\n        createModal: function() {\n            var self = this;\n\n            Str.get_strings([\n                {key: 'confirmapplication_title', component: 'local_jobboard'},\n                {key: 'confirmapplication_text', component: 'local_jobboard'},\n                {key: 'confirmapplication_docs', component: 'local_jobboard'},\n                {key: 'confirmapplication_data', component: 'local_jobboard'},\n                {key: 'confirmapplication_consent', component: 'local_jobboard'},\n                {key: 'confirmapplication_final', component: 'local_jobboard'},\n                {key: 'confirmsubmit', component: 'local_jobboard'},\n                {key: 'cancelsubmit', component: 'local_jobboard'}\n            ]).then(function(strings) {\n                var body = '<div class=\"text-center mb-3\">' +\n                    '<div class=\"jb-confirm-icon info\"><i class=\"fa fa-paper-plane\"></i></div>' +\n                    '<p class=\"lead\">' + strings[1] + '</p>' +\n                    '</div>' +\n                    '<ul class=\"jb-confirm-checklist list-unstyled\">' +\n                    '<li><i class=\"fa fa-check-circle\"></i> ' + strings[2] + '</li>' +\n                    '<li><i class=\"fa fa-check-circle\"></i> ' + strings[3] + '</li>' +\n                    '<li><i class=\"fa fa-check-circle\"></i> ' + strings[4] + '</li>' +\n                    '</ul>' +\n                    '<div class=\"alert alert-warning mt-3 mb-0\">' +\n                    '<i class=\"fa fa-exclamation-triangle mr-2\"></i>' + strings[5] +\n                    '</div>';\n\n                return ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: strings[0],\n                    body: body\n                }).then(function(modal) {\n                    self.modal = modal;\n\n                    // Customize buttons\n                    modal.setSaveButtonText(strings[6]);\n                    modal.getRoot().addClass('jb-confirm-modal');\n                    modal.getRoot().find('[data-action=\"cancel\"]').text(strings[7]);\n\n                    // Handle save button click\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        self.submitForm();\n                    });\n\n                    return modal;\n                });\n            }).catch(Notification.exception);\n        },\n\n        /**\n         * Bind event handlers.\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Intercept form submission\n            this.form.on('submit', function(e) {\n                // Only intercept if it's the main submit button\n                var $clicked = $(document.activeElement);\n                if ($clicked.is(self.submitButton)) {\n                    e.preventDefault();\n                    self.showConfirmation();\n                }\n            });\n\n            // Also handle direct click on submit button\n            this.submitButton.on('click', function(e) {\n                if (!$(this).data('confirmed')) {\n                    e.preventDefault();\n                    self.showConfirmation();\n                }\n            });\n        },\n\n        /**\n         * Show the confirmation modal.\n         */\n        showConfirmation: function() {\n            if (this.modal) {\n                // Update document count in modal if needed\n                this.updateDocumentStatus();\n                this.modal.show();\n            }\n        },\n\n        /**\n         * Update document upload status in the modal.\n         */\n        updateDocumentStatus: function() {\n            // Count uploaded documents\n            var uploadedCount = 0;\n            this.form.find('.filepicker-filelist .filepicker-filename').each(function() {\n                if ($(this).text().trim()) {\n                    uploadedCount++;\n                }\n            });\n\n            this.config.uploadedDocs = uploadedCount;\n\n            // Update visual indicator in modal if all docs uploaded\n            var $docItem = this.modal.getRoot().find('.jb-confirm-checklist li:first-child');\n            if (uploadedCount >= this.config.totalDocs) {\n                $docItem.find('.fa').removeClass('fa-check-circle').addClass('fa-check-circle text-success');\n            } else {\n                $docItem.find('.fa').removeClass('text-success');\n            }\n        },\n\n        /**\n         * Submit the form after confirmation.\n         */\n        submitForm: function() {\n            var self = this;\n\n            // Mark as confirmed\n            this.submitButton.data('confirmed', true);\n\n            // Add loading state\n            this.submitButton.prop('disabled', true);\n            this.submitButton.addClass('is-loading');\n            this.submitButton.val(M.util.get_string('applicationsubmitting', 'local_jobboard'));\n\n            // Close modal\n            this.modal.hide();\n\n            // Submit the form\n            setTimeout(function() {\n                self.form.off('submit');\n                self.submitButton.click();\n            }, 100);\n        }\n    };\n\n    return {\n        /**\n         * Initialize the application confirmation module.\n         *\n         * @param {Object} config Configuration options\n         */\n        init: function(config) {\n            ApplicationConfirm.init(config);\n        }\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Str","Notification","ApplicationConfirm","modal","form","submitButton","init","config","extend","formSelector","totalDocs","uploadedDocs","this","find","length","createModal","bindEvents","self","get_strings","key","component","then","strings","body","create","type","types","SAVE_CANCEL","title","setSaveButtonText","getRoot","addClass","text","on","save","e","preventDefault","submitForm","catch","exception","document","activeElement","is","showConfirmation","data","updateDocumentStatus","show","uploadedCount","each","trim","$docItem","removeClass","prop","val","M","util","get_string","hide","setTimeout","off","click"],"mappings":";;;;;;;;;AAwBAA,4CAAO,CAAC,SAAU,qBAAsB,oBAAqB,WAAY,sBACrE,SAASC,EAAGC,aAAcC,YAAaC,IAAKC,kBAGxCC,mBAAqB,CACrBC,MAAO,KACPC,KAAM,KACNC,aAAc,KAUdC,KAAM,SAASC,aACNA,OAASV,EAAEW,OAAO,CACnBC,aAAc,aACdC,UAAW,EACXC,aAAc,GACfJ,aAEEH,KAAOP,EAAEe,KAAKL,OAAOE,mBACrBJ,aAAeO,KAAKR,KAAKS,KAAK,6CAE9BD,KAAKR,KAAKU,QAAWF,KAAKP,aAAaS,cAIvCC,mBACAC,eAMTD,YAAa,eACLE,KAAOL,KAEXZ,IAAIkB,YAAY,CACZ,CAACC,IAAK,2BAA4BC,UAAW,kBAC7C,CAACD,IAAK,0BAA2BC,UAAW,kBAC5C,CAACD,IAAK,0BAA2BC,UAAW,kBAC5C,CAACD,IAAK,0BAA2BC,UAAW,kBAC5C,CAACD,IAAK,6BAA8BC,UAAW,kBAC/C,CAACD,IAAK,2BAA4BC,UAAW,kBAC7C,CAACD,IAAK,gBAAiBC,UAAW,kBAClC,CAACD,IAAK,eAAgBC,UAAW,oBAClCC,MAAK,SAASC,aACTC,KAAO,0HAEcD,QAAQ,GAFtB,mGAKqCA,QAAQ,GAL7C,+CAMqCA,QAAQ,GAN7C,+CAOqCA,QAAQ,GAP7C,uGAU6CA,QAAQ,GAC5D,gBAEGxB,aAAa0B,OAAO,CACvBC,KAAM3B,aAAa4B,MAAMC,YACzBC,MAAON,QAAQ,GACfC,KAAMA,OACPF,MAAK,SAASlB,cACbc,KAAKd,MAAQA,MAGbA,MAAM0B,kBAAkBP,QAAQ,IAChCnB,MAAM2B,UAAUC,SAAS,oBACzB5B,MAAM2B,UAAUjB,KAAK,0BAA0BmB,KAAKV,QAAQ,IAG5DnB,MAAM2B,UAAUG,GAAGlC,YAAYmC,MAAM,SAASC,GAC1CA,EAAEC,iBACFnB,KAAKoB,gBAGFlC,YAEZmC,MAAMrC,aAAasC,YAM1BvB,WAAY,eACJC,KAAOL,UAGNR,KAAK6B,GAAG,UAAU,SAASE,GAEbtC,EAAE2C,SAASC,eACbC,GAAGzB,KAAKZ,gBACjB8B,EAAEC,iBACFnB,KAAK0B,4BAKRtC,aAAa4B,GAAG,SAAS,SAASE,GAC9BtC,EAAEe,MAAMgC,KAAK,eACdT,EAAEC,iBACFnB,KAAK0B,wBAQjBA,iBAAkB,WACV/B,KAAKT,aAEA0C,4BACA1C,MAAM2C,SAOnBD,qBAAsB,eAEdE,cAAgB,OACf3C,KAAKS,KAAK,6CAA6CmC,MAAK,WACzDnD,EAAEe,MAAMoB,OAAOiB,QACfF,wBAIHxC,OAAOI,aAAeoC,kBAGvBG,SAAWtC,KAAKT,MAAM2B,UAAUjB,KAAK,wCACrCkC,eAAiBnC,KAAKL,OAAOG,UAC7BwC,SAASrC,KAAK,OAAOsC,YAAY,mBAAmBpB,SAAS,gCAE7DmB,SAASrC,KAAK,OAAOsC,YAAY,iBAOzCd,WAAY,eACJpB,KAAOL,UAGNP,aAAauC,KAAK,aAAa,QAG/BvC,aAAa+C,KAAK,YAAY,QAC9B/C,aAAa0B,SAAS,mBACtB1B,aAAagD,IAAIC,EAAEC,KAAKC,WAAW,wBAAyB,wBAG5DrD,MAAMsD,OAGXC,YAAW,WACPzC,KAAKb,KAAKuD,IAAI,UACd1C,KAAKZ,aAAauD,UACnB,aAIJ,CAMHtD,KAAM,SAASC,QACXL,mBAAmBI,KAAKC"}