{"version":3,"file":"bulk_actions.min.js","sources":["../src/bulk_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Bulk actions and confirmation modal AMD module for local_jobboard.\n *\n * Handles bulk selection, bulk actions, and confirmation modals for delete operations.\n *\n * @module     local_jobboard/bulk_actions\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification', 'core/str'], function($, Notification, Str) {\n    'use strict';\n\n    /**\n     * Modal helper object for Bootstrap 4 compatible modal handling.\n     */\n    var JBModal = {\n        /**\n         * Show a modal.\n         * @param {HTMLElement} modal The modal element.\n         */\n        show: function(modal) {\n            if (!modal) {\n                return;\n            }\n            $(modal).addClass('show');\n            modal.style.display = 'block';\n            modal.setAttribute('aria-hidden', 'false');\n            $('body').addClass('modal-open');\n            // Add backdrop.\n            var backdrop = $('<div>', {\n                'class': 'modal-backdrop fade show',\n                'id': 'jb-modal-backdrop'\n            });\n            $('body').append(backdrop);\n        },\n\n        /**\n         * Hide a modal.\n         * @param {HTMLElement} modal The modal element.\n         */\n        hide: function(modal) {\n            if (!modal) {\n                return;\n            }\n            $(modal).removeClass('show');\n            modal.style.display = 'none';\n            modal.setAttribute('aria-hidden', 'true');\n            $('body').removeClass('modal-open');\n            // Remove backdrop.\n            $('#jb-modal-backdrop').remove();\n        }\n    };\n\n    /**\n     * Pending action callback.\n     * @type {Function|null}\n     */\n    var pendingAction = null;\n\n    /**\n     * Update the bulk toolbar visibility and state.\n     * @param {HTMLElement} element The triggering element.\n     */\n    var updateBulkToolbar = function(element) {\n        var $form = $(element).closest('form');\n        if (!$form.length) {\n            $form = $(document);\n        }\n        var $toolbar = $form.find('.jb-bulk-toolbar');\n        if (!$toolbar.length) {\n            return;\n        }\n\n        var $checkboxes = $form.find('.jb-bulk-item');\n        var $checked = $form.find('.jb-bulk-item:checked');\n        var count = $checked.length;\n\n        // Update count.\n        $toolbar.find('.jb-selected-count').text(count);\n\n        // Show/hide toolbar.\n        if (count > 0) {\n            $toolbar.removeClass('d-none');\n        } else {\n            $toolbar.addClass('d-none');\n        }\n\n        // Enable/disable action buttons.\n        $toolbar.find('.jb-bulk-action').prop('disabled', count === 0);\n\n        // Update select all checkbox.\n        var $selectAll = $form.find('.jb-select-all');\n        if ($selectAll.length) {\n            $selectAll.prop('checked', $checkboxes.length > 0 && $checkboxes.length === $checked.length);\n            $selectAll[0].indeterminate = count > 0 && count < $checkboxes.length;\n        }\n    };\n\n    /**\n     * Submit a bulk action.\n     * @param {HTMLElement} form The form element.\n     * @param {string} action The action to perform.\n     */\n    var submitBulkAction = function(form, action) {\n        var $form = $(form);\n        var $actionInput = $form.find('input[name=\"bulkaction\"]');\n        if (!$actionInput.length) {\n            $actionInput = $('<input>', {\n                type: 'hidden',\n                name: 'bulkaction'\n            });\n            $form.append($actionInput);\n        }\n        $actionInput.val(action);\n        form.submit();\n    };\n\n    /**\n     * Show a confirmation modal.\n     * @param {string} message The confirmation message.\n     * @param {Function} onConfirm Callback when confirmed.\n     */\n    var showConfirmModal = function(message, onConfirm) {\n        var modal = document.getElementById('jb-confirm-modal');\n        if (modal) {\n            var $modal = $(modal);\n            var $msgEl = $modal.find('.jb-modal-message');\n\n            if ($msgEl.length) {\n                $msgEl.text(message);\n            }\n\n            // Store the action callback.\n            pendingAction = onConfirm;\n\n            // Show modal.\n            JBModal.show(modal);\n        } else {\n            // Fallback to native confirm if modal not found.\n            Str.get_string('confirm').then(function() {\n                if (window.confirm(message) && onConfirm) {\n                    onConfirm();\n                }\n            }).catch(function() {\n                if (window.confirm(message) && onConfirm) {\n                    onConfirm();\n                }\n            });\n        }\n    };\n\n    /**\n     * Initialize event handlers.\n     */\n    var init = function() {\n        // Select all functionality.\n        $(document).on('change', '.jb-select-all', function() {\n            var target = $(this).data('target');\n            var checked = $(this).prop('checked');\n            $(target).prop('checked', checked);\n            updateBulkToolbar(this);\n        });\n\n        // Individual checkbox change.\n        $(document).on('change', '.jb-bulk-item', function() {\n            updateBulkToolbar(this);\n        });\n\n        // Bulk action buttons.\n        $(document).on('click', '.jb-bulk-action', function(e) {\n            e.preventDefault();\n            var action = $(this).data('action');\n            var confirmMsg = $(this).data('confirm');\n            var formId = $(this).data('form');\n            var form = document.getElementById(formId);\n\n            if (!form) {\n                return;\n            }\n\n            if (confirmMsg) {\n                showConfirmModal(confirmMsg, function() {\n                    submitBulkAction(form, action);\n                });\n            } else {\n                submitBulkAction(form, action);\n            }\n        });\n\n        // Individual action buttons with confirmation.\n        $(document).on('click', '.jb-confirm-trigger', function(e) {\n            e.preventDefault();\n            var confirmMsg = $(this).data('confirm');\n            var url = $(this).attr('href');\n\n            if (confirmMsg) {\n                showConfirmModal(confirmMsg, function() {\n                    window.location.href = url;\n                });\n            } else {\n                window.location.href = url;\n            }\n        });\n\n        // Modal confirm button.\n        $(document).on('click', '.jb-modal-confirm', function() {\n            var modal = document.getElementById('jb-confirm-modal');\n            JBModal.hide(modal);\n            if (pendingAction) {\n                pendingAction();\n                pendingAction = null;\n            }\n        });\n\n        // Modal cancel/close buttons.\n        $(document).on('click', '#jb-confirm-modal [data-dismiss=\"modal\"], #jb-confirm-modal .close', function() {\n            var modal = document.getElementById('jb-confirm-modal');\n            JBModal.hide(modal);\n            pendingAction = null;\n        });\n\n        // Close on backdrop click.\n        $(document).on('click', '#jb-confirm-modal', function(e) {\n            if (e.target === this) {\n                JBModal.hide(this);\n                pendingAction = null;\n            }\n        });\n\n        // Close on Escape key.\n        $(document).on('keydown', function(e) {\n            if (e.key === 'Escape') {\n                var modal = document.getElementById('jb-confirm-modal');\n                if (modal && $(modal).hasClass('show')) {\n                    JBModal.hide(modal);\n                    pendingAction = null;\n                }\n            }\n        });\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Notification","Str","JBModal","modal","addClass","style","display","setAttribute","backdrop","append","removeClass","remove","pendingAction","updateBulkToolbar","element","$form","closest","length","document","$toolbar","find","$checkboxes","$checked","count","text","prop","$selectAll","indeterminate","submitBulkAction","form","action","$actionInput","type","name","val","submit","showConfirmModal","message","onConfirm","getElementById","$msgEl","get_string","then","window","confirm","catch","init","on","target","this","data","checked","e","preventDefault","confirmMsg","formId","url","attr","location","href","key","hasClass"],"mappings":"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"}