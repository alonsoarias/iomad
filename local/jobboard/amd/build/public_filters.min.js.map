{"version":3,"file":"public_filters.min.js","sources":["../src/public_filters.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for public filters with dynamic department loading.\n *\n * @module     local_jobboard/public_filters\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    'use strict';\n\n    /**\n     * Load departments for a given company.\n     *\n     * @param {jQuery} departmentSelect The department select element.\n     * @param {number} companyId The company ID.\n     * @param {number} preselect Optional department ID to preselect.\n     * @param {string} allLabel Label for \"All\" option.\n     */\n    var loadDepartments = function(departmentSelect, companyId, preselect, allLabel) {\n        // Clear current options.\n        departmentSelect.empty();\n\n        // Add \"All\" option.\n        departmentSelect.append($('<option>', {\n            value: 0,\n            text: allLabel || 'Todas las modalidades'\n        }));\n\n        if (!companyId || companyId === '0' || companyId === 0) {\n            return;\n        }\n\n        // Show loading state.\n        departmentSelect.prop('disabled', true);\n\n        // Fetch departments via AJAX endpoint.\n        $.ajax({\n            url: M.cfg.wwwroot + '/local/jobboard/ajax/get_departments.php',\n            method: 'GET',\n            data: {\n                companyid: parseInt(companyId, 10)\n            },\n            dataType: 'json'\n        }).done(function(response) {\n            departmentSelect.empty();\n            departmentSelect.prop('disabled', false);\n\n            // Add \"All\" option.\n            departmentSelect.append($('<option>', {\n                value: 0,\n                text: allLabel || 'Todas las modalidades'\n            }));\n\n            // Add department options.\n            if (response.success && response.departments && response.departments.length > 0) {\n                $.each(response.departments, function(index, dept) {\n                    var option = $('<option>', {\n                        value: dept.id,\n                        text: dept.name\n                    });\n                    // Preselect if specified.\n                    if (preselect && parseInt(preselect, 10) === parseInt(dept.id, 10)) {\n                        option.prop('selected', true);\n                    }\n                    departmentSelect.append(option);\n                });\n            }\n\n        }).fail(function(jqXHR, textStatus, errorThrown) {\n            departmentSelect.empty();\n            departmentSelect.prop('disabled', false);\n            departmentSelect.append($('<option>', {\n                value: 0,\n                text: allLabel || 'Todas las modalidades'\n            }));\n            // eslint-disable-next-line no-console\n            console.error('Error loading departments:', textStatus, errorThrown);\n        });\n    };\n\n    /**\n     * Initialize the public filters handlers.\n     *\n     * @param {Object} options Configuration options.\n     * @param {string} options.companySelector Selector for company element.\n     * @param {string} options.departmentSelector Selector for department element.\n     * @param {number} options.preselect Optional department ID to preselect.\n     * @param {string} options.allLabel Label for \"All\" option.\n     */\n    var init = function(options) {\n        options = options || {};\n\n        var companySelect = $(options.companySelector || '#filter-companyid');\n        var departmentSelect = $(options.departmentSelector || '#filter-departmentid');\n        var allLabel = options.allLabel || 'Todas las modalidades';\n\n        // Exit if elements not found.\n        if (!companySelect.length || !departmentSelect.length) {\n            // eslint-disable-next-line no-console\n            console.log('JobBoard public_filters: Company or department selects not found');\n            return;\n        }\n\n        // eslint-disable-next-line no-console\n        console.log('JobBoard public_filters: Initialized');\n\n        // Handle company change.\n        companySelect.on('change', function() {\n            var companyId = $(this).val();\n            loadDepartments(departmentSelect, companyId, null, allLabel);\n        });\n\n        // Load departments if company is pre-selected.\n        var initialCompany = companySelect.val();\n        if (initialCompany && initialCompany !== '0' && initialCompany !== 0) {\n            loadDepartments(departmentSelect, initialCompany, options.preselect, allLabel);\n        }\n    };\n\n    return {\n        init: init,\n        loadDepartments: loadDepartments\n    };\n});\n"],"names":["define","$","loadDepartments","departmentSelect","companyId","preselect","allLabel","empty","append","value","text","prop","ajax","url","M","cfg","wwwroot","method","data","companyid","parseInt","dataType","done","response","success","departments","length","each","index","dept","option","id","name","fail","jqXHR","textStatus","errorThrown","console","error","init","options","companySelect","companySelector","departmentSelector","log","on","this","val","initialCompany"],"mappings":";;;;;;;AAsBAA,uCAAO,CAAC,WAAW,SAASC,OAWpBC,gBAAkB,SAASC,iBAAkBC,UAAWC,UAAWC,UAEnEH,iBAAiBI,QAGjBJ,iBAAiBK,OAAOP,EAAE,WAAY,CAClCQ,MAAO,EACPC,KAAMJ,UAAY,2BAGjBF,WAA2B,MAAdA,WAAmC,IAAdA,YAKvCD,iBAAiBQ,KAAK,YAAY,GAGlCV,EAAEW,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,2CACrBC,OAAQ,MACRC,KAAM,CACFC,UAAWC,SAAShB,UAAW,KAEnCiB,SAAU,SACXC,MAAK,SAASC,UACbpB,iBAAiBI,QACjBJ,iBAAiBQ,KAAK,YAAY,GAGlCR,iBAAiBK,OAAOP,EAAE,WAAY,CAClCQ,MAAO,EACPC,KAAMJ,UAAY,2BAIlBiB,SAASC,SAAWD,SAASE,aAAeF,SAASE,YAAYC,OAAS,GAC1EzB,EAAE0B,KAAKJ,SAASE,aAAa,SAASG,MAAOC,UACrCC,OAAS7B,EAAE,WAAY,CACvBQ,MAAOoB,KAAKE,GACZrB,KAAMmB,KAAKG,OAGX3B,WAAae,SAASf,UAAW,MAAQe,SAASS,KAAKE,GAAI,KAC3DD,OAAOnB,KAAK,YAAY,GAE5BR,iBAAiBK,OAAOsB,cAIjCG,MAAK,SAASC,MAAOC,WAAYC,aAChCjC,iBAAiBI,QACjBJ,iBAAiBQ,KAAK,YAAY,GAClCR,iBAAiBK,OAAOP,EAAE,WAAY,CAClCQ,MAAO,EACPC,KAAMJ,UAAY,2BAGtB+B,QAAQC,MAAM,6BAA8BH,WAAYC,wBA2CzD,CACHG,KA/BO,SAASC,aAGZC,cAAgBxC,GAFpBuC,QAAUA,SAAW,IAESE,iBAAmB,qBAC7CvC,iBAAmBF,EAAEuC,QAAQG,oBAAsB,wBACnDrC,SAAWkC,QAAQlC,UAAY,2BAG9BmC,cAAcf,QAAWvB,iBAAiBuB,QAO/CW,QAAQO,IAAI,wCAGZH,cAAcI,GAAG,UAAU,eACnBzC,UAAYH,EAAE6C,MAAMC,MACxB7C,gBAAgBC,iBAAkBC,UAAW,KAAME,iBAInD0C,eAAiBP,cAAcM,MAC/BC,gBAAqC,MAAnBA,gBAA6C,IAAnBA,gBAC5C9C,gBAAgBC,iBAAkB6C,eAAgBR,QAAQnC,UAAWC,eAhBrE+B,QAAQO,IAAI,qEAsBhB1C,gBAAiBA"}