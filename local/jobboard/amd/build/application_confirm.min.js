/**
 * Application confirmation modal module.
 *
 * Handles the confirmation dialog before submitting a job application.
 *
 * @module     local_jobboard/application_confirm
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_jobboard/application_confirm",["jquery","core/modal_factory","core/modal_events","core/str","core/notification"],(function($,ModalFactory,ModalEvents,Str,Notification){var ApplicationConfirm={modal:null,form:null,submitButton:null,init:function(config){this.config=$.extend({formSelector:"form.mform",totalDocs:0,uploadedDocs:0},config),this.form=$(this.config.formSelector),this.submitButton=this.form.find('input[type="submit"][name="submitbutton"]'),this.form.length&&this.submitButton.length&&(this.createModal(),this.bindEvents())},createModal:function(){var self=this;Str.get_strings([{key:"confirmapplication_title",component:"local_jobboard"},{key:"confirmapplication_text",component:"local_jobboard"},{key:"confirmapplication_docs",component:"local_jobboard"},{key:"confirmapplication_data",component:"local_jobboard"},{key:"confirmapplication_consent",component:"local_jobboard"},{key:"confirmapplication_final",component:"local_jobboard"},{key:"confirmsubmit",component:"local_jobboard"},{key:"cancelsubmit",component:"local_jobboard"}]).then((function(strings){var body='<div class="text-center mb-3"><div class="jb-confirm-icon info"><i class="fa fa-paper-plane"></i></div><p class="lead">'+strings[1]+'</p></div><ul class="jb-confirm-checklist list-unstyled"><li><i class="fa fa-check-circle"></i> '+strings[2]+'</li><li><i class="fa fa-check-circle"></i> '+strings[3]+'</li><li><i class="fa fa-check-circle"></i> '+strings[4]+'</li></ul><div class="alert alert-warning mt-3 mb-0"><i class="fa fa-exclamation-triangle mr-2"></i>'+strings[5]+"</div>";return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:body}).then((function(modal){return self.modal=modal,modal.setSaveButtonText(strings[6]),modal.getRoot().addClass("jb-confirm-modal"),modal.getRoot().find('[data-action="cancel"]').text(strings[7]),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),self.submitForm()})),modal}))})).catch(Notification.exception)},bindEvents:function(){var self=this;this.form.on("submit",(function(e){$(document.activeElement).is(self.submitButton)&&(e.preventDefault(),self.showConfirmation())})),this.submitButton.on("click",(function(e){$(this).data("confirmed")||(e.preventDefault(),self.showConfirmation())}))},showConfirmation:function(){this.modal&&(this.updateDocumentStatus(),this.modal.show())},updateDocumentStatus:function(){var uploadedCount=0;this.form.find(".filepicker-filelist .filepicker-filename").each((function(){$(this).text().trim()&&uploadedCount++})),this.config.uploadedDocs=uploadedCount;var $docItem=this.modal.getRoot().find(".jb-confirm-checklist li:first-child");uploadedCount>=this.config.totalDocs?$docItem.find(".fa").removeClass("fa-check-circle").addClass("fa-check-circle text-success"):$docItem.find(".fa").removeClass("text-success")},submitForm:function(){var self=this;this.submitButton.data("confirmed",!0),this.submitButton.prop("disabled",!0),this.submitButton.addClass("is-loading"),this.submitButton.val(M.util.get_string("applicationsubmitting","local_jobboard")),this.modal.hide(),setTimeout((function(){self.form.off("submit"),self.submitButton.click()}),100)}};return{init:function(config){ApplicationConfirm.init(config)}}}));

//# sourceMappingURL=application_confirm.min.js.map