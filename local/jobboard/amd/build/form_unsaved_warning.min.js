/**
 * Form unsaved changes warning module.
 *
 * Shows a confirmation dialog when the user tries to leave a page
 * with unsaved form changes.
 *
 * @module     local_jobboard/form_unsaved_warning
 * @copyright  2024 ISER
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_jobboard/form_unsaved_warning",["jquery","core/str","core/notification"],(function($,Str,Notification){var state={formSelector:"form.mform",initialFormData:null,hasChanges:!1,isSubmitting:!1,warningMessage:"",excludedLinks:[".btn-cancel",'[data-action="cancel"]','[type="submit"]']},getFormData=function(form){return form.serialize()},updateChangesState=function(){var form;state.hasChanges=0!==(form=$(state.formSelector)).length&&null!==state.initialFormData&&getFormData(form)!==state.initialFormData},beforeUnloadHandler=function(e){if(state.hasChanges&&!state.isSubmitting)return e.preventDefault(),e.returnValue=state.warningMessage,state.warningMessage},handleLinkClick=function(e){if(!state.isSubmitting&&state.hasChanges){for(var link=$(e.currentTarget),i=0;i<state.excludedLinks.length;i++)if(link.is(state.excludedLinks[i]))return;var href=link.attr("href");href&&"#"!==href&&0!==href.indexOf("javascript:")&&(e.preventDefault(),Notification.confirm(Str.get_string("unsavedchanges","local_jobboard"),state.warningMessage,Str.get_string("leave","local_jobboard"),Str.get_string("stay","local_jobboard"),(function(){state.hasChanges=!1,window.location.href=href})))}},handleFormSubmit=function(){state.isSubmitting=!0};return{init:function(config){(config=config||{}).formSelector&&(state.formSelector=config.formSelector),config.excludedLinks&&(state.excludedLinks=state.excludedLinks.concat(config.excludedLinks)),Str.get_string("unsavedchangeswarning","local_jobboard").done((function(str){state.warningMessage=str})).fail((function(){state.warningMessage="You have unsaved changes. Are you sure you want to leave this page?"})),$(document).ready((function(){var form=$(state.formSelector);0!==form.length&&(setTimeout((function(){state.initialFormData=getFormData(form)}),500),form.on("change input","input, select, textarea",(function(){updateChangesState()})),form.on("submit",handleFormSubmit),form.find('[name="cancel"], .btn-cancel').on("click",(function(){state.isSubmitting=!0})),$(window).on("beforeunload",beforeUnloadHandler),$("a").not(state.excludedLinks.join(", ")).on("click",handleLinkClick),$(".jb-navigation-footer a").on("click",handleLinkClick))}))}}}));

//# sourceMappingURL=form_unsaved_warning.min.js.map