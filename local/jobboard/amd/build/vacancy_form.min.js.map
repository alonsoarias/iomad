{"version":3,"file":"vacancy_form.min.js","sources":["../src/vacancy_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Vacancy form AMD module for local_jobboard.\n *\n * Handles dynamic loading of departments based on company selection.\n *\n * @module     local_jobboard/vacancy_form\n * @copyright  2024 ISER\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n    'use strict';\n\n    /**\n     * Initialize the vacancy form handlers.\n     */\n    var init = function() {\n        var companySelect = $('#id_companyid');\n        var departmentSelect = $('#id_departmentid');\n\n        if (!companySelect.length || !departmentSelect.length) {\n            return;\n        }\n\n        // Handle company change.\n        companySelect.on('change', function() {\n            var companyId = $(this).val();\n\n            // Clear and disable department select while loading.\n            departmentSelect.prop('disabled', true);\n\n            if (!companyId || companyId == '0') {\n                // No company selected, clear departments.\n                Str.get_string('selectdepartment', 'local_jobboard').then(function(str) {\n                    departmentSelect.empty().append($('<option>', {\n                        value: 0,\n                        text: str\n                    }));\n                    departmentSelect.prop('disabled', false);\n                }).catch(Notification.exception);\n                return;\n            }\n\n            // Fetch departments for the selected company.\n            Ajax.call([{\n                methodname: 'local_jobboard_get_departments',\n                args: {\n                    companyid: parseInt(companyId, 10)\n                }\n            }])[0].then(function(departments) {\n                return Str.get_string('selectdepartment', 'local_jobboard').then(function(str) {\n                    departmentSelect.empty();\n                    departmentSelect.append($('<option>', {\n                        value: 0,\n                        text: str\n                    }));\n\n                    if (departments && departments.length > 0) {\n                        departments.forEach(function(dept) {\n                            departmentSelect.append($('<option>', {\n                                value: dept.id,\n                                text: dept.name\n                            }));\n                        });\n                    }\n\n                    departmentSelect.prop('disabled', false);\n                });\n            }).catch(function(error) {\n                Notification.exception(error);\n                departmentSelect.prop('disabled', false);\n            });\n        });\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","init","companySelect","departmentSelect","length","on","companyId","this","val","prop","call","methodname","args","companyid","parseInt","then","departments","get_string","str","empty","append","value","text","forEach","dept","id","name","catch","error","exception"],"mappings":";;;;;;;;;AAyBAA,qCAAO,CAAC,SAAU,YAAa,oBAAqB,aAAa,SAASC,EAAGC,KAAMC,aAAcC,WAiEtF,CACHC,KA5DO,eACHC,cAAgBL,EAAE,iBAClBM,iBAAmBN,EAAE,oBAEpBK,cAAcE,QAAWD,iBAAiBC,QAK/CF,cAAcG,GAAG,UAAU,eACnBC,UAAYT,EAAEU,MAAMC,MAGxBL,iBAAiBM,KAAK,YAAY,GAE7BH,WAA0B,KAAbA,UAalBR,KAAKY,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFC,UAAWC,SAASR,UAAW,QAEnC,GAAGS,MAAK,SAASC,oBACVhB,IAAIiB,WAAW,mBAAoB,kBAAkBF,MAAK,SAASG,KACtEf,iBAAiBgB,QACjBhB,iBAAiBiB,OAAOvB,EAAE,WAAY,CAClCwB,MAAO,EACPC,KAAMJ,OAGNF,aAAeA,YAAYZ,OAAS,GACpCY,YAAYO,SAAQ,SAASC,MACzBrB,iBAAiBiB,OAAOvB,EAAE,WAAY,CAClCwB,MAAOG,KAAKC,GACZH,KAAME,KAAKE,WAKvBvB,iBAAiBM,KAAK,YAAY,SAEvCkB,OAAM,SAASC,OACd7B,aAAa8B,UAAUD,OACvBzB,iBAAiBM,KAAK,YAAY,MArClCT,IAAIiB,WAAW,mBAAoB,kBAAkBF,MAAK,SAASG,KAC/Df,iBAAiBgB,QAAQC,OAAOvB,EAAE,WAAY,CAC1CwB,MAAO,EACPC,KAAMJ,OAEVf,iBAAiBM,KAAK,YAAY,MACnCkB,MAAM5B,aAAa8B"}