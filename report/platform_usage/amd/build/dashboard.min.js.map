{"version":3,"file":"dashboard.min.js","sources":["../src/dashboard.js"],"sourcesContent":["/**\n * Platform Usage Report - Dashboard JavaScript Module\n *\n * @module     report_platform_usage/dashboard\n * @copyright  2024 IOMAD\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* global Chart */\n\ndefine(['jquery', 'core/ajax', 'core/notification'],\n    function($, Ajax, Notification) {\n    'use strict';\n\n    /**\n     * Dashboard controller\n     */\n    var Dashboard = {\n        // Configuration\n        config: {\n            ajaxUrl: '',\n            courseId: 0,\n            inCourseContext: false,\n            sesskey: ''\n        },\n\n        // Chart instances\n        charts: {},\n\n        // Current data\n        currentData: {},\n\n        // Language strings\n        strings: {},\n\n        // Color palette\n        colors: {\n            brand: {\n                primary: '#6366f1',\n                primaryLight: '#818cf8',\n                primaryDark: '#4f46e5'\n            },\n            success: {\n                primary: '#10b981',\n                light: '#34d399'\n            },\n            warning: {\n                primary: '#f59e0b',\n                light: '#fbbf24'\n            },\n            info: {\n                primary: '#06b6d4',\n                light: '#22d3ee'\n            },\n            error: {\n                primary: '#f43f5e',\n                light: '#fb7185'\n            },\n            gray: {\n                50: '#f8fafc',\n                100: '#f1f5f9',\n                200: '#e2e8f0',\n                500: '#64748b',\n                700: '#334155',\n                900: '#0f172a'\n            }\n        },\n\n        /**\n         * Initialize the dashboard\n         *\n         * @param {Object} config Configuration object\n         * @param {Object} initialData Initial report data\n         * @param {Object} strings Language strings\n         */\n        init: function(config, initialData, strings) {\n            this.config = $.extend(this.config, config);\n            this.currentData = initialData;\n            this.strings = strings;\n\n            this.setupChartDefaults();\n            this.initCharts(initialData);\n            this.bindEvents();\n            this.initTooltips();\n        },\n\n        /**\n         * Setup Chart.js global defaults\n         */\n        setupChartDefaults: function() {\n            if (typeof Chart === 'undefined') {\n                return;\n            }\n\n            Chart.defaults.font.family = \"'Inter', system-ui, -apple-system, sans-serif\";\n            Chart.defaults.font.size = 12;\n            Chart.defaults.color = this.colors.gray[500];\n            Chart.defaults.plugins.legend.labels.usePointStyle = true;\n            Chart.defaults.plugins.legend.labels.padding = 16;\n            Chart.defaults.plugins.tooltip.backgroundColor = this.colors.gray[900];\n            Chart.defaults.plugins.tooltip.titleColor = '#ffffff';\n            Chart.defaults.plugins.tooltip.bodyColor = '#e2e8f0';\n            Chart.defaults.plugins.tooltip.borderColor = this.colors.gray[700];\n            Chart.defaults.plugins.tooltip.borderWidth = 1;\n            Chart.defaults.plugins.tooltip.padding = 12;\n            Chart.defaults.plugins.tooltip.cornerRadius = 8;\n            Chart.defaults.plugins.tooltip.displayColors = true;\n            Chart.defaults.plugins.tooltip.boxPadding = 4;\n        },\n\n        /**\n         * Initialize Bootstrap tooltips\n         */\n        initTooltips: function() {\n            // Initialize all tooltips\n            $('[data-toggle=\"tooltip\"]').tooltip({\n                container: 'body',\n                html: true,\n                trigger: 'hover focus'\n            });\n\n            // Re-initialize on dynamic content\n            $(document).on('shown.bs.tab', function() {\n                $('[data-toggle=\"tooltip\"]').tooltip('dispose').tooltip({\n                    container: 'body',\n                    html: true,\n                    trigger: 'hover focus'\n                });\n            });\n        },\n\n        /**\n         * Bind event handlers\n         */\n        bindEvents: function() {\n            var self = this;\n\n            // Global filter button\n            $('#apply-global-filter').on('click', function() {\n                var companyId = $('#companyid').val() || 0;\n                var datefrom = $('#global-datefrom').val();\n                var dateto = $('#global-dateto').val();\n                self.loadReportData(companyId, datefrom, dateto);\n            });\n\n            // Company filter change\n            $('#companyid').on('change', function() {\n                var companyId = $(this).val();\n                var datefrom = $('#global-datefrom').val();\n                var dateto = $('#global-dateto').val();\n                self.loadReportData(companyId, datefrom, dateto);\n            });\n\n            // Course context filter button\n            $('#apply-course-filter').on('click', function() {\n                var datefrom = $('#course-datefrom').val();\n                var dateto = $('#course-dateto').val();\n                self.loadCourseReportData(datefrom, dateto);\n            });\n        },\n\n        /**\n         * Initialize all charts\n         *\n         * @param {Object} data Report data\n         */\n        initCharts: function(data) {\n            var self = this;\n\n            // Destroy existing charts\n            Object.keys(this.charts).forEach(function(key) {\n                if (self.charts[key] && typeof self.charts[key].destroy === 'function') {\n                    self.charts[key].destroy();\n                }\n            });\n            this.charts = {};\n\n            // Daily Logins Chart\n            this.createDailyLoginsChart(data);\n\n            // User Activity Chart\n            this.createUserActivityChart(data);\n\n            // Course Access Chart\n            this.createCourseAccessChart(data);\n\n            // Completion Trends Chart\n            this.createCompletionTrendsChart(data);\n\n            // Dedication Chart\n            this.createDedicationChart(data);\n        },\n\n        /**\n         * Create Daily Logins Line Chart\n         *\n         * @param {Object} data Report data\n         */\n        createDailyLoginsChart: function(data) {\n            var canvas = document.getElementById('dailyLoginsChart');\n            if (!canvas || !data.daily_logins || !data.daily_logins.labels) {\n                return;\n            }\n\n            var ctx = canvas.getContext('2d');\n            this.charts.dailyLogins = new Chart(ctx, {\n                type: 'line',\n                data: {\n                    labels: data.daily_logins.labels,\n                    datasets: [\n                        {\n                            label: this.strings.logins || 'Logins',\n                            data: data.daily_logins.logins,\n                            borderColor: this.colors.brand.primary,\n                            backgroundColor: 'rgba(99, 102, 241, 0.1)',\n                            fill: true,\n                            tension: 0.4\n                        },\n                        {\n                            label: this.strings.uniqueusers || 'Unique users',\n                            data: data.daily_logins.unique_users,\n                            borderColor: this.colors.success.primary,\n                            backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                            fill: true,\n                            tension: 0.4\n                        }\n                    ]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    interaction: {intersect: false, mode: 'index'},\n                    plugins: {legend: {position: 'top'}},\n                    scales: {y: {beginAtZero: true}}\n                }\n            });\n        },\n\n        /**\n         * Create User Activity Doughnut Chart\n         *\n         * @param {Object} data Report data\n         */\n        createUserActivityChart: function(data) {\n            var canvas = document.getElementById('userActivityChart');\n            if (!canvas) {\n                return;\n            }\n\n            var activeUsers;\n            var inactiveUsers;\n            if (this.config.inCourseContext && data.course_stats) {\n                activeUsers = data.course_stats.active_users || 0;\n                inactiveUsers = data.course_stats.inactive_users || 0;\n            } else if (data.user_summary) {\n                activeUsers = data.user_summary.active || 0;\n                inactiveUsers = data.user_summary.inactive || 0;\n            } else {\n                return;\n            }\n\n            var ctx = canvas.getContext('2d');\n            this.charts.userActivity = new Chart(ctx, {\n                type: 'doughnut',\n                data: {\n                    labels: [\n                        this.strings.activeusers || 'Active users',\n                        this.strings.inactiveusers || 'Inactive users'\n                    ],\n                    datasets: [{\n                        data: [activeUsers, inactiveUsers],\n                        backgroundColor: [this.colors.success.primary, this.colors.error.primary],\n                        hoverOffset: 4\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {legend: {position: 'bottom'}}\n                }\n            });\n        },\n\n        /**\n         * Create Course Access Trends Chart\n         *\n         * @param {Object} data Report data\n         */\n        createCourseAccessChart: function(data) {\n            var canvas = document.getElementById('courseAccessChart');\n            if (!canvas || !data.course_access_trends || !data.course_access_trends.labels) {\n                return;\n            }\n\n            var ctx = canvas.getContext('2d');\n            this.charts.courseAccess = new Chart(ctx, {\n                type: 'line',\n                data: {\n                    labels: data.course_access_trends.labels,\n                    datasets: [{\n                        label: this.strings.courseaccesses || 'Course accesses',\n                        data: data.course_access_trends.data,\n                        borderColor: this.colors.warning.primary,\n                        backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                        fill: true,\n                        tension: 0.4\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    interaction: {intersect: false, mode: 'index'},\n                    plugins: {legend: {position: 'top'}},\n                    scales: {y: {beginAtZero: true}}\n                }\n            });\n        },\n\n        /**\n         * Create Completion Trends Chart\n         *\n         * @param {Object} data Report data\n         */\n        createCompletionTrendsChart: function(data) {\n            var canvas = document.getElementById('completionTrendsChart');\n            if (!canvas || !data.completion_trends || !data.completion_trends.labels) {\n                return;\n            }\n\n            var ctx = canvas.getContext('2d');\n            this.charts.completionTrends = new Chart(ctx, {\n                type: 'line',\n                data: {\n                    labels: data.completion_trends.labels,\n                    datasets: [{\n                        label: this.strings.completions || 'Completions',\n                        data: data.completion_trends.data,\n                        borderColor: this.colors.info.primary,\n                        backgroundColor: 'rgba(6, 182, 212, 0.1)',\n                        fill: true,\n                        tension: 0.4\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    interaction: {intersect: false, mode: 'index'},\n                    plugins: {legend: {position: 'top'}},\n                    scales: {y: {beginAtZero: true}}\n                }\n            });\n        },\n\n        /**\n         * Create Dedication Chart (horizontal bar)\n         *\n         * @param {Object} data Report data\n         */\n        createDedicationChart: function(data) {\n            var canvas = document.getElementById('dedicationChart');\n            if (!canvas || !data.top_dedication || data.top_dedication.length === 0) {\n                return;\n            }\n\n            var ctx = canvas.getContext('2d');\n            this.charts.dedication = new Chart(ctx, {\n                type: 'bar',\n                data: {\n                    labels: data.top_dedication.map(function(c) {\n                        var name = c.shortname || c.fullname || '';\n                        return name.length > 18 ? name.substring(0, 15) + '...' : name;\n                    }),\n                    datasets: [{\n                        label: this.strings.dedicationpercent || 'Share',\n                        data: data.top_dedication.map(function(c) {\n                            return c.dedication_percent;\n                        }),\n                        backgroundColor: this.colors.brand.primary,\n                        borderColor: this.colors.brand.primaryDark,\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    indexAxis: 'y',\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {legend: {display: false}},\n                    scales: {\n                        x: {\n                            beginAtZero: true,\n                            max: 100,\n                            ticks: {\n                                callback: function(value) {\n                                    return value + '%';\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n        },\n\n        /**\n         * Load report data via AJAX\n         *\n         * @param {number} companyId Company ID\n         * @param {string} datefrom Date from\n         * @param {string} dateto Date to\n         */\n        loadReportData: function(companyId, datefrom, dateto) {\n            var self = this;\n            var $loading = $('#loading-indicator');\n            $loading.show();\n\n            var datefromTs = new Date(datefrom).getTime() / 1000;\n            var datetoTs = new Date(dateto).getTime() / 1000 + 86399;\n\n            $.ajax({\n                url: this.config.ajaxUrl,\n                method: 'GET',\n                data: {\n                    companyid: companyId,\n                    datefrom: Math.floor(datefromTs),\n                    dateto: Math.floor(datetoTs)\n                },\n                dataType: 'json'\n            }).done(function(data) {\n                self.currentData = data;\n                self.updateSummaryCards(data);\n                self.initCharts(data);\n                self.updateTables(data);\n                self.updateExportLinks(companyId, datefrom, dateto);\n            }).fail(function(jqXHR, textStatus, errorThrown) {\n                Notification.exception({message: 'Error loading report data: ' + errorThrown});\n            }).always(function() {\n                $loading.hide();\n            });\n        },\n\n        /**\n         * Load course report data via AJAX\n         *\n         * @param {string} datefrom Date from\n         * @param {string} dateto Date to\n         */\n        loadCourseReportData: function(datefrom, dateto) {\n            var self = this;\n            var $loading = $('#course-loading-indicator');\n            $loading.show();\n\n            var datefromTs = new Date(datefrom).getTime() / 1000;\n            var datetoTs = new Date(dateto).getTime() / 1000 + 86399;\n\n            $.ajax({\n                url: this.config.ajaxUrl,\n                method: 'GET',\n                data: {\n                    courseid: this.config.courseId,\n                    datefrom: Math.floor(datefromTs),\n                    dateto: Math.floor(datetoTs)\n                },\n                dataType: 'json'\n            }).done(function(data) {\n                self.currentData = data;\n                self.updateSummaryCards(data);\n                self.initCharts(data);\n                self.updateTables(data);\n                self.updateCourseExportLinks(datefrom, dateto);\n            }).fail(function(jqXHR, textStatus, errorThrown) {\n                Notification.exception({message: 'Error loading course data: ' + errorThrown});\n            }).always(function() {\n                $loading.hide();\n            });\n        },\n\n        /**\n         * Update summary cards with new data\n         *\n         * @param {Object} data Report data\n         */\n        updateSummaryCards: function(data) {\n            // Platform Access card\n            this.updateElement('logins-today', this.formatNumber(data.login_summary.logins_today));\n            this.updateElement('logins-week', this.formatNumber(data.login_summary.logins_week));\n            this.updateElement('logins-month', this.formatNumber(data.login_summary.logins_month));\n            this.updateElement('unique-month', this.formatNumber(data.login_summary.unique_users_month));\n            this.updateElement('unique-week', this.formatNumber(data.login_summary.unique_users_week));\n\n            // User Summary card\n            if (data.user_summary) {\n                this.updateElement('total-users', this.formatNumber(data.user_summary.total));\n                this.updateElement('active-users', this.formatNumber(data.user_summary.active));\n                this.updateElement('inactive-users', this.formatNumber(data.user_summary.inactive));\n            }\n\n            // Completions card\n            if (data.completions_summary) {\n                this.updateElement('completions-today',\n                    this.formatNumber(data.completions_summary.completions_today));\n                this.updateElement('completions-week',\n                    this.formatNumber(data.completions_summary.completions_week));\n                this.updateElement('completions-month',\n                    this.formatNumber(data.completions_summary.completions_month));\n                this.updateElement('total-completions',\n                    this.formatNumber(data.completions_summary.total_completions));\n            }\n\n            // Daily Users card\n            if (data.daily_users && data.daily_users.data) {\n                var maxDaily = Math.max.apply(null, data.daily_users.data) || 0;\n                var sum = data.daily_users.data.reduce(function(a, b) {\n                    return a + b;\n                }, 0);\n                var avgDaily = data.daily_users.data.length > 0 ?\n                    Math.round(sum / data.daily_users.data.length) : 0;\n                var todayDaily = data.daily_users.data[data.daily_users.data.length - 1] || 0;\n                this.updateElement('daily-today', this.formatNumber(todayDaily));\n                this.updateElement('daily-avg', this.formatNumber(avgDaily));\n                this.updateElement('daily-max', this.formatNumber(maxDaily));\n            }\n\n            // Course-specific cards\n            if (data.course_stats) {\n                this.updateElement('course-accesses', this.formatNumber(data.course_stats.accesses || 0));\n            }\n        },\n\n        /**\n         * Update tables with new data\n         *\n         * @param {Object} data Report data\n         */\n        updateTables: function(data) {\n            // Update courses table\n            this.updateCoursesTable(data.top_courses || []);\n\n            // Update activities table\n            this.updateActivitiesTable(data.top_activities || []);\n\n            // Update daily users table\n            this.updateDailyUsersTable(data.daily_users || {});\n        },\n\n        /**\n         * Update courses table\n         *\n         * @param {Array} courses List of courses\n         */\n        updateCoursesTable: function(courses) {\n            var $container = $('#top-courses-table');\n            if (!$container.length) {\n                return;\n            }\n\n            if (courses.length === 0) {\n                $container.html('<p class=\"text-muted\">' + (this.strings.nodata || 'No data') + '</p>');\n                return;\n            }\n\n            var html = '<div class=\"table-responsive\"><table class=\"table table-striped table-sm\">';\n            html += '<thead class=\"thead-light\"><tr>';\n            html += '<th>' + (this.strings.coursename || 'Course') + '</th>';\n            html += '<th class=\"text-right\">' + (this.strings.courseaccesses || 'Accesses') + '</th>';\n            html += '<th class=\"text-right\">' + (this.strings.uniqueusers || 'Unique users') + '</th>';\n            html += '</tr></thead><tbody>';\n\n            var self = this;\n            courses.forEach(function(course) {\n                html += '<tr>';\n                html += '<td>' + self.escapeHtml(course.fullname) + '</td>';\n                html += '<td class=\"text-right\">' + self.formatNumber(course.access_count) + '</td>';\n                html += '<td class=\"text-right\">' + self.formatNumber(course.unique_users) + '</td>';\n                html += '</tr>';\n            });\n\n            html += '</tbody></table></div>';\n            $container.html(html);\n        },\n\n        /**\n         * Update activities table\n         *\n         * @param {Array} activities List of activities\n         */\n        updateActivitiesTable: function(activities) {\n            var $container = $('#top-activities-table');\n            if (!$container.length) {\n                return;\n            }\n\n            if (activities.length === 0) {\n                $container.html('<p class=\"text-muted\">' + (this.strings.nodata || 'No data') + '</p>');\n                return;\n            }\n\n            var html = '<div class=\"table-responsive\"><table class=\"table table-striped table-sm\">';\n            html += '<thead class=\"thead-light\"><tr>';\n            html += '<th>' + (this.strings.activityname || 'Activity') + '</th>';\n            html += '<th>' + (this.strings.activitytype || 'Type') + '</th>';\n            html += '<th class=\"text-right\">' + (this.strings.activityaccesses || 'Views') + '</th>';\n            html += '<th class=\"text-right\">' + (this.strings.uniqueusers || 'Unique users') + '</th>';\n            html += '</tr></thead><tbody>';\n\n            var self = this;\n            activities.forEach(function(activity) {\n                html += '<tr>';\n                html += '<td>' + self.escapeHtml(activity.name) + '</td>';\n                html += '<td><span class=\"badge badge-secondary\">';\n                html += self.escapeHtml(activity.type_name || activity.type) + '</span></td>';\n                html += '<td class=\"text-right\">' + self.formatNumber(activity.access_count) + '</td>';\n                html += '<td class=\"text-right\">' + self.formatNumber(activity.unique_users) + '</td>';\n                html += '</tr>';\n            });\n\n            html += '</tbody></table></div>';\n            $container.html(html);\n        },\n\n        /**\n         * Update daily users table\n         *\n         * @param {Object} dailyUsers Daily users data\n         */\n        updateDailyUsersTable: function(dailyUsers) {\n            var $container = $('#daily-users-table');\n            if (!$container.length || !dailyUsers.records) {\n                return;\n            }\n\n            if (dailyUsers.records.length === 0) {\n                $container.html('<p class=\"text-muted p-3\">' + (this.strings.nodata || 'No data') + '</p>');\n                return;\n            }\n\n            var html = '<div class=\"table-responsive\" style=\"max-height: 250px; overflow-y: auto;\">';\n            html += '<table class=\"table table-striped table-sm mb-0\">';\n            html += '<thead class=\"thead-light\" style=\"position: sticky; top: 0;\"><tr>';\n            html += '<th>' + (this.strings.date || 'Date') + '</th>';\n            html += '<th class=\"text-right\">' + (this.strings.uniqueusers || 'Unique users') + '</th>';\n            html += '</tr></thead><tbody>';\n\n            var self = this;\n            dailyUsers.records.forEach(function(record) {\n                html += '<tr>';\n                html += '<td>' + record.fecha_formateada + '</td>';\n                html += '<td class=\"text-right\"><span class=\"badge badge-primary\">';\n                html += self.formatNumber(record.cantidad_usuarios) + '</span></td>';\n                html += '</tr>';\n            });\n\n            html += '</tbody></table></div>';\n            $container.html(html);\n        },\n\n        /**\n         * Update export links with current filters\n         *\n         * @param {number} companyId Company ID\n         * @param {string} datefrom Date from\n         * @param {string} dateto Date to\n         */\n        updateExportLinks: function(companyId, datefrom, dateto) {\n            var datefromTs = Math.floor(new Date(datefrom).getTime() / 1000);\n            var datetoTs = Math.floor(new Date(dateto).getTime() / 1000 + 86399);\n\n            $('#export-excel, #export-csv').each(function() {\n                var $link = $(this);\n                var url = $link.attr('href');\n                url = url.replace(/companyid=\\d+/, 'companyid=' + companyId);\n                url = url.replace(/datefrom=\\d+/, 'datefrom=' + datefromTs);\n                url = url.replace(/dateto=\\d+/, 'dateto=' + datetoTs);\n                $link.attr('href', url);\n            });\n        },\n\n        /**\n         * Update course export links with current filters\n         *\n         * @param {string} datefrom Date from\n         * @param {string} dateto Date to\n         */\n        updateCourseExportLinks: function(datefrom, dateto) {\n            var datefromTs = Math.floor(new Date(datefrom).getTime() / 1000);\n            var datetoTs = Math.floor(new Date(dateto).getTime() / 1000 + 86399);\n\n            $('#export-excel-course, #export-csv-course').each(function() {\n                var $link = $(this);\n                var url = $link.attr('href');\n                url = url.replace(/datefrom=\\d+/, 'datefrom=' + datefromTs);\n                url = url.replace(/dateto=\\d+/, 'dateto=' + datetoTs);\n                $link.attr('href', url);\n            });\n        },\n\n        /**\n         * Update element text content\n         *\n         * @param {string} id Element ID\n         * @param {string} value New value\n         */\n        updateElement: function(id, value) {\n            var $el = $('#' + id);\n            if ($el.length) {\n                $el.text(value);\n            }\n        },\n\n        /**\n         * Format number with thousands separator\n         *\n         * @param {number} num Number to format\n         * @returns {string} Formatted number\n         */\n        formatNumber: function(num) {\n            if (num === null || num === undefined) {\n                return '0';\n            }\n            return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n        },\n\n        /**\n         * Escape HTML special characters\n         *\n         * @param {string} text Text to escape\n         * @returns {string} Escaped text\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n    };\n\n    return {\n        /**\n         * Initialize the dashboard module\n         *\n         * @param {Object} config Configuration\n         * @param {Object} initialData Initial data\n         * @param {Object} strings Language strings\n         */\n        init: function(config, initialData, strings) {\n            Dashboard.init(config, initialData, strings);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Dashboard","config","ajaxUrl","courseId","inCourseContext","sesskey","charts","currentData","strings","colors","brand","primary","primaryLight","primaryDark","success","light","warning","info","error","gray","init","initialData","extend","this","setupChartDefaults","initCharts","bindEvents","initTooltips","Chart","defaults","font","family","size","color","plugins","legend","labels","usePointStyle","padding","tooltip","backgroundColor","titleColor","bodyColor","borderColor","borderWidth","cornerRadius","displayColors","boxPadding","container","html","trigger","document","on","self","companyId","val","datefrom","dateto","loadReportData","loadCourseReportData","data","Object","keys","forEach","key","destroy","createDailyLoginsChart","createUserActivityChart","createCourseAccessChart","createCompletionTrendsChart","createDedicationChart","canvas","getElementById","daily_logins","ctx","getContext","dailyLogins","type","datasets","label","logins","fill","tension","uniqueusers","unique_users","options","responsive","maintainAspectRatio","interaction","intersect","mode","position","scales","y","beginAtZero","activeUsers","inactiveUsers","course_stats","active_users","inactive_users","user_summary","active","inactive","userActivity","activeusers","inactiveusers","hoverOffset","course_access_trends","courseAccess","courseaccesses","completion_trends","completionTrends","completions","top_dedication","length","dedication","map","c","name","shortname","fullname","substring","dedicationpercent","dedication_percent","indexAxis","display","x","max","ticks","callback","value","$loading","show","datefromTs","Date","getTime","datetoTs","ajax","url","method","companyid","Math","floor","dataType","done","updateSummaryCards","updateTables","updateExportLinks","fail","jqXHR","textStatus","errorThrown","exception","message","always","hide","courseid","updateCourseExportLinks","updateElement","formatNumber","login_summary","logins_today","logins_week","logins_month","unique_users_month","unique_users_week","total","completions_summary","completions_today","completions_week","completions_month","total_completions","daily_users","maxDaily","apply","sum","reduce","a","b","avgDaily","round","todayDaily","accesses","updateCoursesTable","top_courses","updateActivitiesTable","top_activities","updateDailyUsersTable","courses","$container","coursename","course","escapeHtml","access_count","nodata","activities","activityname","activitytype","activityaccesses","activity","type_name","dailyUsers","records","date","record","fecha_formateada","cantidad_usuarios","each","$link","attr","replace","id","$el","text","num","toString","div","createElement","textContent","innerHTML"],"mappings":"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"}